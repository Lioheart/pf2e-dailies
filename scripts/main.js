(()=>{var es=Object.defineProperty;var l=(t,e)=>es(t,"name",{value:e,configurable:!0});var ts=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)};var tt=(t,e,s)=>(ts(t,e,"read from private field"),s?s.call(t):e.get(t)),st=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)};var w="pf2e-dailies",be=async function(){}.constructor;function F(t){return game.settings.get(w,t)}l(F,"getSetting");function ve(t,e){return game.settings.set(w,t,e)}l(ve,"setSetting");function Z(...t){return`${w}.settings.${t.join(".")}`}l(Z,"getSettingLocalizationPath");function Q(t){let e=t.name;t.scope=t.scope??"world",t.config=t.config??!0,t.config&&(t.name=Z(e,"name"),t.hint=Z(e,"hint")),Array.isArray(t.choices)&&(t.choices=t.choices.reduce((s,r)=>(s[r]=Z(e,"choices",r),s),{})),game.settings.register(w,e,t)}l(Q,"registerSetting");function rt(t){let e=t.name;t.name=Z("menus",e,"name"),t.label=Z("menus",e,"label"),t.hint=Z("menus",e,"hint"),t.restricted=t.restricted??!0,t.icon=t.icon??"fas fa-cogs",game.settings.registerMenu(w,e,t)}l(rt,"registerSettingMenu");function K(...t){return t=t.filter(e=>typeof e=="string"),`modules/${w}/templates/${t.join("/")}`}l(K,"templatePath");function x(t,e,s){return t.getFlag(w,e)??s}l(x,"getFlag");function we(t,e,s){return t.setFlag(w,e,s)}l(we,"setFlag");function S(...t){let[e,s]=t;return e=`${w}.${e}`,s?game.i18n.format(e,s):game.i18n.localize(e)}l(S,"localize");function re(t){return game.i18n.has(`${w}.${t}`,!1)}l(re,"hasLocalization");function Ne(t){return`${w}.${t}`}l(Ne,"localizePath");function T(t){let e=l((...s)=>S(`${t}.${s[0]}`,s[1]),"fn");return Object.defineProperties(e,{warn:{value:(...s)=>C(`${t}.${s[0]}`,s[1],s[2]),enumerable:!1,configurable:!1},info:{value:(...s)=>ss(`${t}.${s[0]}`,s[1],s[2]),enumerable:!1,configurable:!1},error:{value:(...s)=>z(`${t}.${s[0]}`,s[1],s[2]),enumerable:!1,configurable:!1},has:{value:s=>re(`${t}.${s}`),enumerable:!1,configurable:!1},path:{value:s=>Ne(`${t}.${s}`),enumerable:!1,configurable:!1},template:{value:(s,{hash:r})=>e(s,r),enumerable:!1,configurable:!1}}),e}l(T,"subLocalize");function nt(){return CONFIG.ChatMessage.documentClass}l(nt,"getChatMessageClass");function $e(t,e,s,r){let n=typeof e=="string"?e:"info",o=typeof e=="object"?e:typeof s=="object"?s:void 0,i=typeof e=="boolean"?e:typeof s=="boolean"?s:r??!1;ui.notifications.notify(S(t,o),n,{permanent:i})}l($e,"notify");function C(...t){let[e,s,r]=t;$e(e,"warning",s,r)}l(C,"warn");function ss(...t){let[e,s,r]=t;$e(e,"info",s,r)}l(ss,"info");function z(...t){let[e,s,r]=t;$e(e,"error",s,r)}l(z,"error");function Se(t){return t.getFlag("core","sourceId")}l(Se,"getSourceId");function B(t,e,s=[]){typeof s=="string"&&(s=[s]);for(let r of s){let n=t.itemTypes[r].find(o=>o.sourceId===e);if(n)return n}}l(B,"findItemWithSourceId");function ke(t,e){let s=[];if(t<=e)for(let r=t;r<=e;r++)s.push(r);else for(let r=t;r>=e;r--)s.push(r);return s}l(ke,"sequenceArray");function xe(t){return t?t[0].toUpperCase()+t.slice(1):""}l(xe,"capitalize");function Me(t,e){return e?`@UUID[${t}]{${e}}`:`@UUID[${t}]`}l(Me,"chatUUID");function it(t){return`<span style="background: #DDD;
    padding: 1px 4px;
    border: 1px solid var(--color-border-dark-tertiary);
    border-radius: 2px;
    white-space: nowrap;
    word-break: break-all;">${t}</span>`}l(it,"fakeChatUUID");function at(t,e){if(typeof t!="object")return!1;for(;t=Reflect.getPrototypeOf(t);)if(t.constructor.name===e)return!0;return!1}l(at,"isInstanceOf");function Ie(t,e,s={},r,n){return{key:t,label:n,item:{uuid:e},rows:[{type:"drop",slug:"spell",filter:{type:"spell",search:s}}],process:async({addSpell:i,utils:a,fields:c,messages:u})=>{let d=c.spell.uuid,p=await a.createSpellSource(d),m=`${p.name} (Level ${r||p.system.level.value})`;i(p,r),u.add("spells",{uuid:d,label:m})}}}l(Ie,"createSpellDaily");function ot(){let t=Ie("ace","Compendium.pf2e.feats-srd.Item.POrE3ZgBRdBL9MsW",{category:["cantrip","spell"],level:4},4),e=t.rows[0];return e.filter.drop=s=>{let r=s.system.time.value;return r.includes("hour")||r.includes("min")&&parseInt(r)>10?{error:Ne("interface.error.drop.wrongSpellTime"),data:{time:"10 min"}}:!0},t}l(ot,"tricksterAce");var ct={key:"blade",item:{uuid:"Compendium.pf2e.classfeatures.Item.EtltLdiy9kNfHU0c"},children:[{slug:"good",uuid:"Compendium.pf2e.classfeatures.Item.nxZYP3KGfTSkaW6J"},{slug:"evil",uuid:"Compendium.pf2e.classfeatures.Item.JiY2ZB4FkK8RJm4T"},{slug:"liberator",uuid:"Compendium.pf2e.classfeatures.Item.FCoMFUsth4xB4veC"},{slug:"paladin",uuid:"Compendium.pf2e.classfeatures.Item.peEXunfbSD8WcMFk"},{slug:"antipaladin",uuid:"Compendium.pf2e.classfeatures.Item.EQ6DVIQHAUXUhY6Y"},{slug:"tyrant",uuid:"Compendium.pf2e.classfeatures.Item.HiIvez0TqESbleB5"},{slug:"spirit",uuid:"Compendium.pf2e.feats-srd.Item.h5ksUZlrVGBjq6p4"},{slug:"master",uuid:"Compendium.pf2e.feats-srd.Item.jYEMVfrXJLpXS6aC"}],rows:[{type:"select",slug:"weapon",label:()=>S("label.blade.weapon"),options:({actor:t})=>t.itemTypes.weapon.filter(e=>!e.isAlchemical).map(e=>({value:e.id,label:e.name}))},{type:"select",slug:"rune",label:()=>S("label.blade.rune"),options:({children:t})=>{let e=["returning","shifting"],{antipaladin:s,evil:r,good:n,liberator:o,master:i,paladin:a,spirit:c,tyrant:u}=t;return c&&(e.push("flaming"),n&&e.push("holy"),r&&e.push("unholy"),(o||s)&&e.push("anarchic"),(a||u)&&e.push("axiomatic")),n&&e.push("disrupting","ghost-touch"),i&&e.push("greater-disrupting","keen"),r&&e.push("fearsome"),e.map(d=>({value:d,label:lt(d)}))},condition:({actor:t})=>t.itemTypes.weapon.filter(e=>!e.isAlchemical).length}],process:async({actor:t,fields:e,addRule:s,messages:r})=>{let n=e.weapon.value,o=e.rune.value,i=t.items.get(n);if(!i)return;s({definition:[`item:id:${n}`],key:"AdjustStrike",mode:"add",property:"property-runes",value:o},i),s({key:"CriticalSpecialization",predicate:[{or:[`item:category:${i.category}`,`item:id:${n}`]}]},i);let a=i.name!==i._source.name?`... ${i._source.name}`:i.name;r.addGroup("blade"),r.add("blade",{uuid:i.uuid,label:a,selected:lt(o)})}};function lt(t){let e=t.replace(/-\w/,s=>s[1].toUpperCase());return game.i18n.localize(`PF2E.WeaponPropertyRune.${e}.Name`)}l(lt,"localizeRune");var rs="systems/pf2e/icons/equipment/weapons/wish-knife.webp",ut={key:"ceremonial",item:{uuid:"Compendium.pf2e.feats-srd.Item.78pkCdFaY8hI07Lj",condition:({actor:t})=>t.itemTypes.weapon.some(e=>e.group==="knife")},rows:[{type:"drop",slug:"spell",label:({utils:t,actor:e})=>t.spellRankLabel(Ue(e)),filter:{type:"spell",search:({actor:t})=>({category:["spell"],level:Ue(t)})}}],process:async({actor:t,fields:e,utils:s,item:r,addItem:n,messages:o})=>{let i=e.spell.uuid,a=Ue(t),c=await s.createWandSource({uuid:i,level:a,itemName:r.name,itemImg:rs});n(c),o.addGroup("ceremonial"),o.add("ceremonial",{uuid:i,label:c.name})}};function Ue(t){return Math.ceil((t.level-5)/2)}l(Ue,"calculateRank");var ns=["first","second","third","fourth","fifth","sixth","seventh"];function je(t,e,s){return{key:t,label:s,item:{uuid:e[0]},children:[{slug:"expert",uuid:e[1]},{slug:"master",uuid:e[2]}],rows:[V("first",1),V("second",2,8),V("third",3,void 0,"expert"),V("fourth",4,14,"expert"),V("fifth",5,16,"expert"),V("sixth",6,void 0,"master"),V("seventh",7,20,"master")],process:async({utils:n,fields:o,addItem:i,messages:a})=>{for(let c of Object.values(o)){let u=c.uuid,d=ns.indexOf(c.row)+1,p=await n.createSpellScrollSource({uuid:u,level:d});i(p),a.add("scrolls",{uuid:u,label:p.name})}}}}l(je,"createScrollChain");function V(t,e,s,r){let n={type:"drop",slug:t,label:({utils:o})=>o.spellRankLabel(e),filter:{type:"spell",search:{category:["spell"],level:e}}};return s&&(n.condition=({actor:o})=>o.level>=s),r&&(n.childPredicate=[r]),n}l(V,"createRow");function Ce(t,e,s={},r){return{key:t,label:r,item:{uuid:e},rows:[{type:"drop",slug:"feat",filter:{type:"feat",search:s}}],process:async({utils:o,fields:i,addFeat:a,messages:c})=>{let u=i.feat.uuid,d=await o.createFeatSource(u);a(d),c.add("feats",{uuid:u})}}}l(Ce,"createFeatDaily");var ft={key:"flexibility",item:{uuid:"Compendium.pf2e.classfeatures.Item.8g6HzARbhfcgilP8"},children:[{slug:"improved",uuid:"Compendium.pf2e.classfeatures.Item.W2rwudMNcAxs8VoX"}],rows:[dt("flexibility",8),dt("improved",14,"improved")],process:async({utils:t,fields:e,addFeat:s,messages:r,children:n})=>{let o=e.flexibility.uuid,i=await t.createFeatSource(o);if(s(i),r.add("feats",{uuid:o}),n.improved){let a=e.improved.uuid,c=await t.createFeatSource(a);s(c,n.improved),r.add("feats",{uuid:a})}}};function dt(t,e,s){let r={type:"drop",label:`PF2E.Level${e}`,slug:t,filter:{type:"feat",search:{category:["class"],traits:["fighter"],level:e}}};return s&&(r.childPredicate=[s]),r}l(dt,"createRow");function ne(t,e,s){return{key:t,label:s,item:{uuid:e},rows:[{type:"select",slug:"language",options:({actor:r,utils:n})=>{let o=r.system.traits.languages.value;return n.languageNames.filter(i=>!o.includes(i)).sort()},labelizer:({utils:r})=>r.languageLabel}],process:({addRule:r,utils:n,fields:o,messages:i})=>{let a=o.language.value,c=n.createLanguageRuleElement({language:a});r(c),i.add("languages",{uuid:e,selected:n.languageLabel(a),label:s})}}}l(ne,"createLanguageDaily");var ze="Compendium.pf2e-dailies.equipment.Item.VpmEozw21aRxX15P",pt="Compendium.pf2e.feats-srd.Item.PccekOihIbRWdDky",is={0:{die:"d4",traits:["finesse","agile"],usage:"held-in-one-hand"},1:{die:"d6",traits:["finesse"],usage:"held-in-one-hand"},2:{die:"d8",traits:[],usage:"held-in-one-hand"},3:{die:"d10",traits:["reach"],usage:"held-in-two-hands"}},gt={slashing:"sword",piercing:"spear",bludgeoning:"club"},mt=["grapple","nonlethal","shove","trip","modular"],as=Object.keys(gt),os=["corrosive","disrupting","flaming","frost","shock","thundering"],ls=["anarchic","axiomatic","greaterCorrosive","greaterDisrupting","greaterFlaming","greaterFrost","greaterShock","greaterThundering","holy","unholy"],yt={key:"mindsmith",item:{uuid:"Compendium.pf2e.feats-srd.Item.juikoiIA0Jy8PboY"},children:[{slug:"weapon",uuid:ze},{slug:"mental",uuid:pt},{slug:"runic",uuid:"Compendium.pf2e.feats-srd.Item.2uQbQgz1AbjzcFSp"},{slug:"advanced",uuid:"Compendium.pf2e.feats-srd.Item.fgnfXwFcn9jZlXGD"}],rows:[{type:"alert",slug:"alert",message:()=>S("interface.alert.weapon"),fix:cs,childPredicate:[{not:"weapon"}]},{type:"select",slug:"smith",label:()=>S("label.mindsmith"),options:as,labelizer:({utils:t})=>t.damageLabel,childPredicate:["weapon"]},...[1,2].map(t=>({type:"select",slug:`mental${t}`,label:()=>S("label.mentalforge",{nb:t}),options:mt,labelizer:({utils:e})=>e.weaponTraitLabel,unique:"mental",childPredicate:["weapon","mental"]})),{type:"select",slug:"runic",label:()=>S("label.runicmind"),options:os,labelizer:({utils:t})=>t.weaponPropertyRunesLabel,childPredicate:["weapon","runic",{not:"advanced"}],condition:({children:t,utils:e})=>e.hasFreePropertySlot(t.weapon)},{type:"select",slug:"advanced",label:()=>S("label.runicmind"),options:ls,labelizer:({utils:t})=>t.weaponPropertyRunesLabel,childPredicate:["weapon","advanced"],condition:({children:t,utils:e})=>e.hasFreePropertySlot(t.weapon)}],process:({children:t,updateItem:e,fields:s,messages:r,item:n,utils:o})=>{let i=t.weapon;if(!i)return;r.addGroup("mindsmith");let a=s.smith.value;if(e({_id:i.id,"system.damage.damageType":a,"system.group":gt[a]}),r.add("mindsmith",{selected:o.damageLabel(a),uuid:n.uuid,label:"mindsmith"}),t.mental){let c=deepClone(i._source.system.traits?.value??[]);for(let u of[1,2]){let d=s[`mental${u}`].value;c.includes(d)||c.push(d),e({_id:i.id,"system.traits.value":c}),r.add("mindsmith",{selected:o.weaponTraitLabel(d),uuid:t.mental.uuid,label:S("label.mentalforge",{nb:u})})}}if((t.advanced||t.runic)&&o.hasFreePropertySlot(i)){let c=t.advanced??t.runic,u=o.getFreePropertyRuneSlot(i),p=(s.advanced??s.runic).value;u&&!i.system.runes.property.includes(p)&&(e({_id:i.id,[`system.${u}.value`]:p,[`flags.${w}.runeSlot`]:u}),r.add("mindsmith",{selected:o.weaponPropertyRunesLabel(p),uuid:c.uuid,label:"runicmind"}))}},rest:({item:t,sourceId:e,updateItem:s,actor:r})=>{if(e!==ze)return;if(B(r,pt)){let i=t._source.system.traits?.value??[];i=i.filter(a=>!mt.includes(a)),s({_id:t.id,"system.traits.value":i})}let o=x(t,"runeSlot");o&&s({_id:t.id,[`system.${o}.value`]:null,[`flags.${w}.-=runeSlot`]:!0})}};async function cs({actor:t}){let e=T("dialog.weapon"),s=e("flavor");for(let n of["0","1","2","3"]){let o=e(`option.${n}`);s+=`<label><input type="radio" name="type" value="${n}">${o}</label>`}let r=await Dialog.wait({title:e("title"),content:s,buttons:{yes:{icon:'<i class="fas fa-save"></i>',label:e("accept"),callback:us},no:{icon:'<i class="fas fa-times"></i>',label:e("cancel"),callback:()=>null}},close:()=>null},{},{id:"pf2e-dailies-weapon",width:600});return r?(await t.createEmbeddedDocuments("Item",[r]),!0):!1}l(cs,"fix");async function us(t){let e=T("dialog.weapon"),s=t.find("[name=type]:checked").val();if(!s){e.warn("error.noSelection");return}let r=(await fromUuid(ze))?.toObject();if(!r){e.warn("error.missing");return}let n=is[s];return setProperty(r,"system.damage.die",n.die),setProperty(r,"system.traits.value",n.traits.slice()),setProperty(r,"system.usage.value",n.usage),r}l(us,"onWeaponSelected");function ie(t,e,s,r,n,o){return{key:t,label:n,item:{uuid:e},rows:[{type:o?"random":"select",slug:"resistance",options:s,labelizer:({utils:a})=>a.resistanceLabel}],process:async({utils:a,fields:c,actor:u,addRule:d,messages:p})=>{let m=o?await a.randomOption(s):c.resistance.value,y=typeof r=="number"?r:r==="half"?a.halfLevelValue(u):u.level,f=a.createResistanceRuleElement({type:m,value:y});d(f),p.add("resistances",{uuid:e,selected:a.resistanceLabel(m,y),label:n,random:o})}}}l(ie,"createResistancelDaily");var ds="Compendium.pf2e.feat-effects.Item.jO7wMhnjT7yoAtQg",ht={key:"root",item:{uuid:"Compendium.pf2e.feats-srd.Item.22P7IFyhrF7Fbw8B"},rows:[{type:"select",slug:"target",options:({actor:t,utils:e})=>e.getPlayersActors(t).map(r=>({value:r.id,label:r.name}))}],process:({fields:t,messages:e})=>{let s=t.target.value,r=game.actors.get(s);r&&(e.addGroup("root"),e.add("root",{uuid:ds,selected:r.name}))}};var fs="Compendium.pf2e.feats-srd.Item.NV9H39kbkbjhAK6X";function W(){return game.modules.get("pf2e-staves")?.active}l(W,"isPF2eStavesActive");function ae(t){if(!t)return;let e=x(t,"staff")??getProperty(t,"flags.pf2e-staves");if(e)return delete e.prevDescription,deepClone(e)}l(ae,"getSpellcastingEntryStaffFlags");function oe(t){let e=ae(t);if(!e)return;e.overcharge??=0,e.max=ce(t.actor)+e.overcharge;let s=(()=>{let r=t.actor;return!e.charges||e.overcharge||e.makeshift||!r?{}:r.spellcasting.filter(n=>n.isSpontaneous).reduce((n,o)=>{for(let i=1;i<=10;i++){let a=o.system.slots[`slot${i}`];a.max&&a.value&&(n[i]=!0)}return n},{})})();return e.canPayCost=r=>e.charges&&(r<=e.charges||s[r]),e}l(oe,"getSpellcastingEntryStaffData");async function le(t,e){let s=oe(t);if(!s)return;let r=Math.clamped(e,0,s.max);if(r!==s.charges)return s.charges=r,we(t,"staff",s)}l(le,"updateEntryCharges");function bt(t){return[{type:"weapon",trait:"magical"},{type:"equipment",trait:"coda"}].flatMap(({type:e,trait:s})=>t.itemTypes[e].filter(r=>{let n=r.system.traits?.value;return n&&n.includes("staff")&&n.includes(s)}))}l(bt,"getStaves");function ce(t){let e=0,s=ue(t);for(let n of s){let o=De(n);o>e&&(e=o)}if(B(t,fs,"feat")){let n=Math.ceil(t.level/2);n>e&&(e=n)}return e}l(ce,"getMaxSlotRankForStaves");async function vt(t,...e){let s=ae(this);if(!s)return t(...e);let r=this.actor;if(!r.items.get(s.staveID)?.isEquipped){C("staves.noStaff");return}let[o,{level:i}]=e,a=o.computeCastRank(i);if(!i||i==="0")return o.toMessage(void 0,{data:{castLevel:a}});if(s.charges<1||s.charges<a&&s.overcharge){C("staves.noCharge");return}let c=[];if(!s.overcharge){let u=r.spellcasting.filter(m=>m.isSpontaneous&&m.system.slots[`slot${a}`].value),d=!1,p=l(m=>m.system.slots[`slot${a}`].value,"entryRankValue");if(u.length===1){let m=u[0],y=S("staves.spontaneous.one",{rank:R.spellRankLabel(a),entry:m.name,remaining:p(m)});d=await Dialog.confirm({title:S("staves.spontaneous.title"),defaultYes:!1,content:`<div class="pf2e-dailies-spontaneous">${y}</div>`}),d&&(d=0)}else if(u.length>1){let m=u.map((f,h)=>({index:h,name:f.name,remaining:p(f)})),y=await renderTemplate(K("staves-spontaneous.hbs"),{entries:m,castRank:R.spellRankLabel(a),i18n:(f,{hash:h})=>S(`staves.spontaneous.${f}`,h)});d=await Dialog.wait({title:S("staves.spontaneous.title"),content:y,buttons:{yes:{icon:'<i class="fas fa-check"></i>',label:game.i18n.localize("Yes"),callback:f=>f.find("input[name=entry]:checked").val()},no:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("No"),callback:()=>!1}},close:()=>null})}if(d===null)return;if(d!==!1){let m=u[d],y=m.system.slots[`slot${a}`].value;c.push({_id:m.id,[`system.slots.slot${a}.value`]:y-1}),s.charges-=1}}if(!c.length){if(s.charges<a){C("staves.noCharge");return}s.charges-=a}c.push({_id:this.id,[`flags.${w}.staff`]:s}),await r.updateEmbeddedDocuments("Item",c),await o.toMessage(void 0,{data:{castLevel:a}})}l(vt,"onSpellcastingEntryCast");function ue(t,{itemOnly:e,innate:s,focus:r}={}){return t.spellcasting.regular.filter(n=>!(n.flags?.["pf2e-staves"]||x(n,"staff")||!s&&n.isInnate||!r&&n.isFocusPool||n.system.prepared.value==="items"&&(!e||e==="scroll"&&n.system.prepared.validItems!=="scroll")))}l(ue,"getValidSpellcastingList");function De(t){let e=0;if(t.system.prepared.value==="items"){let s=Math.ceil(t.actor.level/2);s>e&&(e=s)}else for(let s=0;s<=10;s++)t.system.slots[`slot${s}`].max&&(e=Math.max(e,s));return e}l(De,"getSpellcastingEntryMaxSlotRank");function wt(t){let e=[],s=t.spellcasting.filter(r=>r.isPrepared);for(let r of s)for(let n=1;n<=10;n++){let o=r.system.slots[`slot${n}`];if(o.max)for(let[i,{id:a,prepared:c,expended:u}]of Object.entries(o.prepared)){if(c===!1||u)continue;let d=r.spells.get(a);d&&e.push({spell:d,rank:n,index:i})}}return e}l(wt,"getPreparedSpells");function St(t,e){if(!t)return;e??=t.rank;let s=t.spellcasting,n=Object.entries(s.system.slots[`slot${e}`].prepared).find(([o,{id:i,expended:a}])=>i===t.id&&a!==!0);if(n)return{slotIndex:n[0],entry:s}}l(St,"getNotExpendedPreparedSpellSlot");function kt(t){let e=ue(t,{itemOnly:!0}),s={mod:0};for(let r of e){let n=r.statistic.mod;if(n<=s.mod)continue;let{ability:o,tradition:i,proficiency:a}=r.system;s={ability:o,tradition:i,proficiency:a,mod:n}}if(s.mod)return s}l(kt,"getBestSpellcastingEntry");function xt(t){let e=0;for(let s of t.spellcasting)s.sort>e&&(e=s.sort);return e}l(xt,"getHighestSpellcastingEntrySort");var It={key:"savant",item:{uuid:"Compendium.pf2e.feats-srd.Item.u5DBg0LrBUKP0JsJ"},prepare:({actor:t})=>{let{maxSlot:e,maxTradition:s}=ps(t,"arcane");return{first:{level:e-2,condition:!0},second:{level:e-3,condition:!0},third:{level:e-4,condition:s>=3&&e>=5},fourth:{level:e-5,condition:s>=4&&e>=6}}},rows:["first","second","third","fourth"].map(t=>({type:"drop",slug:t,label:({custom:s,utils:r})=>r.spellRankLabel(s[t].level),filter:{type:"spell",search:({custom:s})=>({category:["spell"],traditions:["arcane"],level:s[t].level})},condition:({custom:s})=>s[t].condition})),process:async({utils:t,fields:e,custom:s,addItem:r,messages:n})=>{for(let o of Object.values(e)){let i=o.uuid,a=await t.createSpellScrollSource({uuid:i,level:s[o.row].level});r(a),n.add("scrolls",{uuid:i,label:a.name})}}};function ps(t,e){let s=1,r=0,n=ue(t);for(let o of n){let i=De(o);i>s&&(s=i),o.tradition===e&&(r=Math.max(r,o.rank))}return{maxSlot:Math.min(s,10),maxTradition:r}}l(ps,"getSpellcastingTraditionDetails");function H(t,e,s){return{key:t,label:s,item:{uuid:e},rows:[{type:"combo",slug:"skill",options:({actor:n,utils:o})=>{let i=n.skills;return o.skillNames.filter(a=>i[a].rank<1)},labelizer:({utils:n})=>n.skillLabel}],process:({fields:n,addItem:o,addRule:i,utils:a,messages:c})=>{let u=n.skill.value;if(n.skill.input==="true"){let d=a.createLoreSource({name:u,rank:1});o(d)}else{let d=a.createSkillRuleElement({skill:u,value:1});u=a.skillLabel(u),i(d)}c.add("skills",{uuid:e,selected:u,label:s})}}}l(H,"createTrainedSkillDaily");function Ee(t,e,s){return{key:t,label:s,item:{uuid:e},rows:[{type:"input",slug:"skill"}],process:({addItem:n,utils:o,fields:i,messages:a})=>{let c=i.skill.value,u=o.createLoreSource({name:c,rank:1});n(u),a.add("skills",{uuid:e,selected:c,label:s})}}}l(Ee,"createTrainedLoreDaily");var Ct={key:"tome",item:{uuid:"Compendium.pf2e.classfeatures.Item.MyN1cQgE0HsLF20e"},children:[{slug:"adept",uuid:"Compendium.pf2e.classfeatures.Item.Obm4ItMIIr0whYeO",condition:We("adept")},{slug:"second",uuid:"Compendium.pf2e.classfeatures.Item.ZEUxZ4Ta1kDPHiq5",condition:We("adept")},{slug:"intense",uuid:"Compendium.pf2e.feats-srd.Item.yRRM1dsY6jakEMaC"},{slug:"paragon",uuid:"Compendium.pf2e.classfeatures.Item.QEtgbY8N2V4wTbsI",condition:We("paragon")}],prepare:({utils:t,actor:e,children:s})=>{let r=t.skillNames,n=e.level,o=e.skills,i={first:{options:[],rank:1},second:{options:[],rank:1}};if(s.paragon){let a=r.filter(c=>o[c].rank<4);i.first={rank:4,options:a},i.second={rank:4,options:a}}else if(s.intense||s.adept||s.second){let a=r.filter(c=>o[c].rank<3);if(n>=9)i.first={rank:3,options:a},i.second={rank:3,options:a};else{let c=r.filter(u=>o[u].rank<2);i.first={rank:2,options:c},i.second={rank:3,options:a}}}else if(n>=5){let a=r.filter(c=>o[c].rank<2);i.first={rank:2,options:a},i.second={rank:2,options:a}}else if(n>=3){let a=r.filter(u=>o[u].rank<1),c=r.filter(u=>o[u].rank<2);i.first={rank:1,options:a},i.second={rank:2,options:c}}else{let a=r.filter(c=>o[c].rank<1);i.first={rank:1,options:a},i.second={rank:1,options:a}}return i},rows:["first","second"].map(t=>({type:"combo",slug:t,label:({custom:s,utils:r})=>r.proficiencyLabel(s[t].rank),options:({custom:s})=>s[t].options,labelizer:({utils:s})=>s.skillLabel})),process:({custom:t,fields:e,utils:s,messages:r,addItem:n,addRule:o})=>{r.addGroup("tome",65);for(let i of["first","second"]){let a=t[i].rank,c=e[i].value;if(e[i].input==="true"){let u=s.createLoreSource({name:c,rank:a});n(u)}else{let u=s.createSkillRuleElement({skill:c,value:a});c=s.skillLabel(c),o(u)}r.add("tome",{label:s.proficiencyLabel(a),selected:c})}}};function We(t){return function({item:e,utils:s,actor:r}){let n=s.getChoiSetRuleSelection(e);return r.items.get(n)?.slug==="tome"}}l(We,"createChildCondition");var ms=["root-magic"],Ge=[Ct,H("longevity","Compendium.pf2e.feats-srd.Item.WoLh16gyDp8y9WOZ"),H("ageless","Compendium.pf2e.feats-srd.Item.wylnETwIz32Au46y"),H("memories","Compendium.pf2e.feats-srd.Item.ptEOt3lqjxUnAW62"),H("studies","Compendium.pf2e.feats-srd.Item.9bgl6qYWKHzqWZj0"),Ee("study","Compendium.pf2e.feats-srd.Item.aLJsBBZzlUK3G8MW"),ne("linguistics","Compendium.pf2e.feats-srd.Item.eCWQU16hRLfN1KaX"),ne("borts","Compendium.pf2e.equipment-srd.Item.iS7hAQMAaThHYE8g"),ie("elementalist","Compendium.pf2e.feats-srd.Item.tx9pkrpmtqe4FnvS",["air","earth","fire","water"],"half","elementalist"),ie("ganzi","Compendium.pf2e.heritages.Item.3reGfXH0S82hM7Gp",["acid","electricity","sonic"],"half","ganzi",!0),Ce("metamagical","Compendium.pf2e.classfeatures.Item.89zWKD2CN7nRu2xp",{category:["class"],traits:{selected:["spellshape","wizard"],conjunction:"and"},level:"half"}),ft,It,je("esoterica",["Compendium.pf2e.feats-srd.Item.OqObuRB8oVSAEKFR","Compendium.pf2e.feats-srd.Item.nWd7m0yRcIEVUy7O","Compendium.pf2e.feats-srd.Item.LHjPTV5vP3MOsPPJ"]),je("trickster",["Compendium.pf2e.feats-srd.Item.ROAUR1GhC19Pjk9C","Compendium.pf2e.feats-srd.Item.UrOj9TROtn8nuxPf","Compendium.pf2e.feats-srd.Item.lIg5Gzz7W70jfbk1"]),ot(),yt,ct,ht,ut],gs=Oe(Ge,"dailies"),de=new Map;function Oe(t,e){let s=new Map;for(let r of t){let n=deepClone(r);try{let o=`${e}.${n.key}`;if(s.set(n.item.uuid,{daily:n,condition:n.item.condition}),n.key=o,n.children)for(let i=0;i<n.children.length;i++){let{uuid:a,condition:c}=n.children[i];s.set(a,{daily:n,index:i,condition:c})}}catch(o){z("error.unexpected"),console.error(o),console.error(`The error occured during data gathering of ${e}.${n.key}`)}}return s}l(Oe,"prepareDailies");var fe=[];async function qe(){de.clear(),fe=[];let t=F("customDailies");for(let{key:s,code:r}of t)try{let o=await new be(r)();if(!Be(o,!0))continue;fe.push(o)}catch(n){z("error.unexpected"),console.error(n),console.error(`The error occured during call of custom function for ${s}`)}for(let[s,r]of gs.entries())de.set(s,r);let e=Oe(fe,"custom");for(let[s,r]of e.entries())de.set(s,r)}l(qe,"parseCustomDailies");function Be(t,e=!1){return ms.includes(t.key)?(e&&game.user.isGM&&C("deprecated.custom.key",{name:t.label.trim()||t.key},!0),!1):!0}l(Be,"checkCustomDaily");function Dt(t){let e={};for(let s of t.items){let r=Se(s);if(!r||s.isOfType("physical")&&s.isInvested===!1)continue;let n=de.get(r);if(!n)continue;let{daily:o,index:i,condition:a}=n;try{if(typeof a=="function"&&!a({actor:t,item:s,utils:R}))continue;e[o.key]??=deepClone(o),i===void 0?e[o.key].item=s:e[o.key].children[i].item=s}catch(c){z("error.unexpected"),console.error(c),console.error(`The error occured during data gathering of ${o.key}`)}}return Object.values(e).filter(s=>s.item&&s.item instanceof Item)}l(Dt,"getDailies");function Et(t){return de.get(t)?.daily}l(Et,"getDailyFromSourceId");function Ae(){return game.packs.get("pf2e.familiar-abilities")}l(Ae,"getFamiliarPack");function Ot(t){return`Compendium.pf2e.familiar-abilities.Item.${t}`}l(Ot,"familiarUUID");var ys="Compendium.pf2e.equipment-srd.Item.L9ZV076913otGtiB";function Fe(t){return B(t,ys,"consumable")}l(Fe,"getRations");function Ve(t){return typeof t=="object"&&t!==null}l(Ve,"isObject");function Y(t,e){return game.pf2e.system.sluggify(t,e)}l(Y,"sluggify");var N=class extends Array{constructor(...e){super(...Array.isArray(e[0])?e[0]:e),this.isValid=N.isValid(this)}static isValid(e){return this.isArray(e)}static isArray(e){return super.isArray(e)&&e.every(s=>X.isStatement(s))}static test(e=[],s){return e instanceof N?e.test(s):new N(...e).test(s)}test(e){if(this.length===0)return!0;if(!this.isValid)return console.warn("PF2e System | The provided predicate set is malformed."),!1;let s=e instanceof Set?e:new Set(e);return this.every(r=>this.#e(r,s))}toObject(){return deepClone([...this])}clone(){return new N(this.toObject())}#e(e,s){return typeof e=="string"&&s.has(e)||X.isBinaryOp(e)&&this.#r(e,s)||X.isCompound(e)&&this.#s(e,s)}#r(e,s){if("eq"in e)return s.has(`${e.eq[0]}:${e.eq[1]}`);{let r=Object.keys(e)[0],[n,o]=Object.values(e)[0],i=Array.from(s),a=l(d=>{let p=Number(d);if(!Number.isNaN(p))return[p];let m=new RegExp(String.raw`^${d}:([^:]+)$`),y=i.map(f=>Number(m.exec(f)?.[1]||NaN)).filter(f=>!Number.isNaN(f));return y.length>0?y:[NaN]},"getValues"),c=a(n),u=a(o);switch(r){case"gt":return c.some(d=>u.every(p=>d>p));case"gte":return c.some(d=>u.every(p=>d>=p));case"lt":return c.some(d=>u.every(p=>d<p));case"lte":return c.some(d=>u.every(p=>d<=p));default:return console.warn("PF2e System | Malformed binary operation encountered"),!1}}}#s(e,s){return"and"in e&&e.and.every(r=>this.#e(r,s))||"nand"in e&&!e.nand.every(r=>this.#e(r,s))||"or"in e&&e.or.some(r=>this.#e(r,s))||"xor"in e&&e.xor.filter(r=>this.#e(r,s)).length===1||"nor"in e&&!e.nor.some(r=>this.#e(r,s))||"not"in e&&!this.#e(e.not,s)||"if"in e&&!(this.#e(e.if,s)&&!this.#e(e.then,s))}};l(N,"PredicatePF2e");var Te,X=class{static isStatement(e){return e instanceof Object?this.isCompound(e)||this.isBinaryOp(e):typeof e=="string"?this.isAtomic(e):!1}static isAtomic(e){return typeof e=="string"&&e.length>0||this.isBinaryOp(e)}static isBinaryOp(e){if(!Ve(e))return!1;let s=Object.entries(e);if(s.length>1)return!1;let[r,n]=s[0];return tt(this,Te).has(r)&&Array.isArray(n)&&n.length===2&&typeof n[0]=="string"&&["string","number"].includes(typeof n[1])}static isCompound(e){return Ve(e)&&(this.isAnd(e)||this.isOr(e)||this.isNand(e)||this.isXor(e)||this.isNor(e)||this.isNot(e)||this.isIf(e))}static isAnd(e){return Object.keys(e).length===1&&Array.isArray(e.and)&&e.and.every(s=>this.isStatement(s))}static isNand(e){return Object.keys(e).length===1&&Array.isArray(e.nand)&&e.nand.every(s=>this.isStatement(s))}static isOr(e){return Object.keys(e).length===1&&Array.isArray(e.or)&&e.or.every(s=>this.isStatement(s))}static isXor(e){return Object.keys(e).length===1&&Array.isArray(e.xor)&&e.xor.every(s=>this.isStatement(s))}static isNor(e){return Object.keys(e).length===1&&Array.isArray(e.nor)&&e.nor.every(s=>this.isStatement(s))}static isNot(e){return Object.keys(e).length===1&&!!e.not&&this.isStatement(e.not)}static isIf(e){return Object.keys(e).length===2&&this.isStatement(e.if)&&this.isStatement(e.then)}};l(X,"StatementValidator"),Te=new WeakMap,st(X,Te,new Set(["eq","gt","gte","lt","lte"]));var hs={select:100,combo:80,random:60,alert:40,input:20,drop:0};async function Ft({children:t=[],key:e,item:s,prepare:r,label:n,rows:o=[]}){let i=this.actor,a=this.saved[e]=x(i,e)??{},c=this.rows[e]={},u=this.children[e]=t.reduce((g,{slug:v,item:k})=>(g[v]=k,g),{}),d={actor:i,item:s,children:u,utils:R},p=this.custom[e]=r&&await r(d)||{},m=this.dailyArgs[e]={...d,custom:p},y=await He(n,m),f=y?`label.${y}`:e.startsWith("dailies.")?`label.${e.slice(8)}`:void 0;f&&re(f)&&(y=S(f));let h=this.predicate[e]=t.filter(g=>g.item).map(g=>g.slug),b={label:y?game.i18n.localize(y):s.name,rows:[]};for(let g of o){c[g.slug]=g;let{type:v,slug:k,childPredicate:I=[],condition:_,label:E,save:q,unique:J}=g;if(I.length&&!N.test(I,h)||_&&!await _(m))continue;let O=q===!1||v==="random"?void 0:a[k],ye=await He(E,m),_e=O===void 0?"":typeof O!="object"?O:"name"in O?O.name:O.selected,P={label:ye?game.i18n.localize(ye):"",value:_e,order:hs[v],data:{type:v,daily:e,row:k,...J?{unique:J}:""}};if(At(g)||bs(g)||vs(g)){let U=await He(g.options,m)??[];if(v!=="combo"&&!U.length)continue;let j=typeof g.labelizer=="function"&&g.labelizer(m)||(A=>xe(A));P.options=U.map(A=>typeof A=="string"?{value:A,label:j(A)}:A),At(g)&&(P.selected=P.value,P.data.input=O?.input??!0,!P.data.input&&U.includes(P.selected)&&(P.value=j(P.selected)))}else ws(g)?P.data.uuid=O?.uuid??"":Ss(g)&&(P.value=typeof g.message=="function"?await g.message(m):g.message);b.rows.push(P)}return b}l(Ft,"getTemplate");async function He(t,e){return typeof t=="function"?await t(e):t}l(He,"getProcessedValue");function At(t){return t.type==="combo"}l(At,"isComboRow");function bs(t){return t.type==="select"}l(bs,"isSelectRow");function vs(t){return t.type==="random"}l(vs,"isRandomRow");function ws(t){return t.type==="drop"}l(ws,"isDropRow");function Ss(t){return t.type==="alert"}l(Ss,"isAlerRow");function Tt(){return Object.entries(CONFIG.PF2E.skillList).reduce((t,[e,s])=>({...t,[e]:game.i18n.localize(s).toLocaleLowerCase(game.i18n.lang)}),{})}l(Tt,"getTranslatedSkills");function Re(t,e,s){if(e===void 0)return s;if(typeof e=="number")return e;if(e==="level")return t.level;if(e==="half")return Math.max(1,Math.floor(t.level/2));let r=Number(e);return isNaN(r)?s:r}l(Re,"getSimplifiableValue");async function Rt(t){return{type:t.type,search:await(t.type==="feat"?xs(this.actor,t.search):ks(this.actor,t.search)),drop:t.drop}}l(Rt,"parseFilter");function M(t,e){t?.length&&(e.selected=t,e.isExpanded=!0,t.forEach(s=>e.options[s].selected=!0))}l(M,"checkFilter");function Pt(t,e){let s=Pe(t);s?.selected.length&&(e.conjunction=s.conjunction,e.selected=s.selected)}l(Pt,"setTraits");function Pe(t){if(!t)return;let e=Array.isArray(t)?t:t.selected;if(e?.length)return{selected:e.map(s=>typeof s=="string"?{value:s}:s),conjunction:!Array.isArray(t)&&t.conjunction||"and"}}l(Pe,"getFilterTraits");async function ks(t,e){let s=await game.pf2e.compendiumBrowser.tabs.spell.getFilterData();M(e.category,s.checkboxes.category),M(e.school,s.checkboxes.school),M(e.traditions,s.checkboxes.traditions),M(e.rarity,s.checkboxes.rarity),M(e.source,s.checkboxes.source),Pt(e.traits,s.multiselects.traits);let r=Ye(t,e.level);return r?.length&&M(r,s.checkboxes.rank),s}l(ks,"parseSpellFilter");async function xs(t,e){let s=await game.pf2e.compendiumBrowser.tabs.feat.getFilterData();M(e.category,s.checkboxes.category),M(e.skills,s.checkboxes.skills),M(e.rarity,s.checkboxes.rarity),M(e.source,s.checkboxes.source),Pt(e.traits,s.multiselects.traits);let r=Xe(t,e.level);return r&&(s.sliders.level.values.min=r.min,s.sliders.level.values.max=r.max,s.sliders.level.isExpanded=!0),s}l(xs,"parseFeatFilter");function Ye(t,e){if(Array.isArray(e))return e;let s=Re(t,e);if(s)return ke(1,s)}l(Ye,"getSpellFilterLevel");function Xe(t,e){if(e!==void 0)return typeof e=="object"?{min:Re(t,e.min,0),max:Re(t,e.min,20)}:{min:0,max:Re(t,e,20)}}l(Xe,"getFeatFilterLevel");var D=T("interface.error.drop");async function Lt(t,e,s){if(!t.isOfType("feat"))return D("notFeat");let{search:r,drop:n}=s;if(r.category?.length&&!r.category.includes(t.category))return D.warn("wrongType",{types:ee("featCategories",r.category)});if(r.traits){let i=Pe(r.traits);if(i?.selected.length){let a=i.conjunction==="or"?"some":"every";if(!i.selected[a](u=>Number(u.not??!1)-Number(t.traits.has(u.value))))return D.warn("wrongTraits")}}if(r.skills?.length){let i=Tt(),a=t.system.prerequisites.value.map(u=>u.value.toLocaleLowerCase());if(!r.skills.some(u=>a.some(d=>d.includes(u)||d.includes(i[u]))))return D.warn("wrongSkill",{skills:ee("skillList",r.skills)})}if(r.rarity?.length&&!r.rarity.includes(t.system.traits.rarity))return D.warn("wrongRarity",{rarities:ee("rarityTraits",r.rarity)});if(r.source?.length&&!r.source.includes(Y(t.system.source.value)))return D.warn("wrongSource",{sources:r.source.join(", ")});let o=Xe(this.actor,r.level);if(o){let i=t.level;if(i<o.min)return D.warn("wrongLevelLow",{level:`min: ${o.min}`});if(i>o.max)return D.warn("wrongLevelHigh",{level:`max: ${o.max}`})}if(n){let i=this.dailyArgs[e.dataset.daily];if(i){let a=await n(t,i);if(typeof a=="object")return a.data?game.i18n.format(a.error,a.data):game.i18n.localize(a.error);if(a===!1)return D.warn("wrongCustom")}}pe(t,e)}l(Lt,"onDropFeat");async function _t(t,e,s){if(!t.isOfType("spell"))return D("notSpell");let{search:r,drop:n}=s;if(r.category?.length){let i=r.category.map(a=>game.i18n.localize(a==="cantrip"?"PF2E.SpellCantripLabel":CONFIG.PF2E.preparationType[a])).join(", ");if(t.isCantrip&&!r.category.includes("cantrip")||t.isFocusSpell&&!r.category.includes("focus")||t.isRitual&&!r.category.includes("ritual")||!t.isCantrip&&!t.isFocusSpell&&!t.isRitual&&!r.category.includes("spell"))return D.warn("wrongCategory",{categories:i})}if(r.traits){let i=Pe(r.traits);if(i?.selected.length){let a=i.conjunction==="or"?"some":"every";if(!i.selected[a](u=>Number(u.not??!1)-Number(t.traits.has(u.value))))return D.warn("wrongTraits")}}if(r.traditions?.length&&!r.traditions.some(i=>t.traditions.has(i)))return D.warn("wrongTradition",{traditions:ee("magicTraditions",r.traditions)});let o=Ye(this.actor,r.level);if(o?.length&&!o.includes(t.level))return D.warn("wrongLevel",{levels:o.join(", ")});if(r.school?.length&&!r.school.includes(t.school))return D.warn("wrongSchool",{schools:ee("magicSchools",r.school)});if(r.rarity?.length&&!r.rarity.includes(t.system.traits.rarity))return D.warn("wrongRarity",{rarities:ee("rarityTraits",r.rarity)});if(r.source?.length&&!r.source.includes(Y(t.system.source.value)))return D.warn("wrongSource",{sources:r.source.join(", ")});if(n){let i=this.dailyArgs[e.dataset.daily];if(i){let a=await n(t,i);if(typeof a=="object")return a.data?ui.notifications.warn(game.i18n.format(a.error,a.data)):ui.notifications.warn(game.i18n.localize(a.error));if(a===!1)return D.warn("wrongCustom")}}pe(t,e)}l(_t,"onDropSpell");function ee(t,e){return e.map(r=>game.i18n.localize(CONFIG.PF2E[t][r])).join(", ")}l(ee,"localizeAll");function pe(t,e){e.value=t.name,e.dataset.uuid=t.uuid,e.nextElementSibling.nextElementSibling.classList.remove("disabled")}l(pe,"onDropItem");var Is=["cantrips?","1st","2nd","3rd","4th","5th","6th","7th","8th","9th","10th"].join("|");async function Nt(){let t=this.actor,e=this.dailies,s=Ds.call(this),r=[],n=new Map,[o,i]=Le(),a={},c=T("message"),u=!1,d="",p=l(f=>{let h=f.id,b=n.get(h);if(b)return b;let g=deepClone(f._source.system.rules);for(let v=g.length-1;v>=0;v--)w in g[v]&&g.splice(v,1);return n.set(h,g),g},"getRules"),m={languages:{order:80,messages:[]},skills:{order:70,messages:[]},resistances:{order:60,messages:[]},feats:{order:50,messages:[]},spells:{order:40,messages:[]},scrolls:{order:30,messages:[]}},y={add:(f,h)=>{m[f]??={order:0,messages:[]},m[f].messages.push(h)},addGroup:(f,h=1,b)=>{m[f]??={label:b,order:h,messages:[]}}};if(t.familiar&&s["dailies.familiar"]){let f=t.familiar,h=Ae(),b=[],g=f.itemTypes.action.map(v=>v.id);g.length&&f.deleteEmbeddedDocuments("Item",g),y.addGroup("familiar",20);for(let v of Object.values(s["dailies.familiar"])){let k=v.value,I=k.includes("."),_=await(I?fromUuid(k):h.getDocument(k));if(!_||!_.isOfType("action"))continue;let E=_.toObject();E&&(b.push(E),y.add("familiar",{uuid:I?k:Ot(k)}))}b.length&&f.createEmbeddedDocuments("Item",b)}if(s["dailies.rations"]?.rations.value==="true"){let f=Fe(t);if(f?.uses.value){let h=f.quantity,{value:b,max:g}=f.uses;b<=1?h<=1?f.delete():i({_id:f.id,"system.quantity":Math.max(f.quantity-1,0),"system.charges.value":g}):i({_id:f.id,"system.charges.value":Math.max(b-1,0)});let v=(h-1)*g+b,k=v<=1?it(f.name):Me(f.uuid);v<=1?d+=c("rations.last",{name:k}):v<=3?d+=c("rations.almost",{name:k,nb:v-1}):d+=c("rations.used",{name:k,nb:v-1})}}if(s["dailies.staff"]){let f=s["dailies.staff"],h=f.staffID.value,b=t.items.get(h),g=f.makeshift?.value==="true",v=g?0:ce(t);if(b&&(v||g)){let k=[],I,_=new RegExp(`<strong>\\s*(?<rank>(?:${Is}))\\s*</strong>.+?(?<uuids>@(?:UUID|Compendium)[[a-zA-Z0-9-.]+].+?)
`,"gi");for(;(I=_.exec(b.description))!==null;){let E=parseInt(I.groups.rank.trim())||0,q,J=/@(?<protocole>UUID|Compendium)\[(?<uuid>[a-zA-Z0-9-.]+)\]/g;for(;(q=J.exec(I.groups.uuids))!==null;){let O=q.groups.uuid;q.groups.protocole==="Compendium"&&(O.startsWith("Compendium.")||(O=`Compendium.${O}`)),k.push({rank:E,uuid:O})}}if(k.length){let E=0,q=[],J=g?[1,2,3]:[1];for(let U of J){let j=f[`expend${U}`],A=t.items.get(j?.value),he=j?.optionData.rank,et=St(A,he);if(et){let{entry:Qt,slotIndex:Kt}=et;E+=+he,i({_id:Qt.id,[`system.slots.slot${he}.prepared.${Kt}.expended`]:!0}),q.push({uuid:A.uuid,name:A.name,rank:he})}}let{ability:O,tradition:ye,proficiency:_e}=kt(t)??{},P={type:"spellcastingEntry",name:b.name,sort:F("staff-sort")==="bottom"?xt(t)+1e4:-1e4,system:{ability:O,prepared:{value:"charge"},showSlotlessLevels:{value:!1},showUnpreparedSpells:{value:!1},proficiency:_e,tradition:ye},flags:{[w]:{type:"staff",staff:{charges:v+E,staveID:h,overcharge:E,makeshift:g}}}};r.push(P),await Promise.all(k.map(async({rank:U,uuid:j})=>{let A=await R.createSpellSource(j);setProperty(A,`flags.${w}.entry`,{level:U,type:"staff"}),r.push(A)})),y.addGroup("staff",45,S(`staves.message.${E?"withExpend":"noExpend"}`,{makeshift:g?S("staves.makeshift"):""})),y.add("staff",{uuid:b.uuid});for(let{uuid:U,name:j,rank:A}of q)y.add("staff",{uuid:U,label:`${j} (${R.spellRankLabel(A)})`})}}}for(let{item:f,key:h,process:b}of e){if(!s[h])continue;let g=this.dailyArgs[h];try{await b({...g,fields:s[h],messages:y,addItem:v=>r.push(v),updateItem:i,addRule:(v,k)=>{v[w]=!0,p(k??f).push(v)},addFeat:(v,k)=>{if(k??=f,k.isOfType("feat")){let I=k.id;setProperty(v,"flags.pf2e.grantedBy",{id:I,onDelete:"cascade"}),setProperty(v,`flags.${w}.grantedBy`,I)}r.push(v)},addSpell:(v,k)=>{setProperty(v,`flags.${w}.entry`,{level:k,type:"fallback"}),r.push(v),u=!0}})}catch(v){z("error.unexpected"),console.error(v),console.error(`The error occured during processing of ${h}`)}}for(let[f,h]of Object.entries(s)){let b=this.rows[f];if(b)for(let{row:g,type:v,input:k,value:I,uuid:_}of Object.values(h)){if(v==="random"||b[g]?.save===!1)continue;let E=a[f]??={};v==="combo"?E[g]={input:k==="true",selected:I}:v==="drop"?E[g]={uuid:_,name:I}:E[g]=I}}for(let[f,h]of n)i({_id:f,"system.rules":h});if(u){let f={type:"spellcastingEntry",name:S("spellEntry.name"),system:{prepared:{value:"innate"},showSlotlessLevels:{value:!1},showUnpreparedSpells:{value:!1},proficiency:{value:1,slug:t.classDC?.slug||t.class?.slug||void 0}},flags:{[w]:{type:"fallback"}}};r.push(f)}for(let f of r)getProperty(f,"system.temporary")===!0||setProperty(f,`flags.${w}.temporary`,!0);if(r.length){let f=await t.createEmbeddedDocuments("Item",r);for(let h of f)if(h.isOfType("feat")){let b=x(h,"grantedBy");if(b){let v=`flags.pf2e.itemGrants.${Y(h.name,{camel:"dromedary"})}`;i({_id:b,[v]:{id:h.id,onDelete:"detach"}})}}else if(h.isOfType("spellcastingEntry")){let b=x(h,"type"),g=f.filter(v=>v.isOfType("spell")&&x(v,"entry")?.type===b);for(let v of g){let{level:k}=x(v,"entry"),I={_id:v.id,"system.location.value":h.id};k!==void 0&&(I["system.location.heightenedLevel"]=k),i(I)}}}await t.update({[`flags.${w}`]:{...expandObject(a),rested:!1}}),o.size&&await t.updateEmbeddedDocuments("Item",o.contents),d=Cs(m,d),d=d?`${c("changes")}<hr />${d}`:c("noChanges"),ChatMessage.create({content:d,speaker:ChatMessage.getSpeaker({actor:t})})}l(Nt,"processData");function Cs(t,e){let s=T("message"),r=Object.entries(t).map(([n,o])=>(o.label??=s.has(n)?s(n):s("gained",{type:n}),o));r.sort((n,o)=>o.order-n.order);for(let{label:n,messages:o}of r)if(o.length){e&&(e+="<hr />"),n&&(e+=`<p><strong>${n}</strong></p>`);for(let{uuid:i,selected:a,label:c,random:u}of o){let d=`label.${c}`;c=c&&re(d)?S(d):c||"",e+="<p>",e+=i?`${Me(i,c)}`:`<strong>${c}</strong>`,a&&(e+=` <span>${a}</span>`),u&&(e+=' <i class="fa-solid fa-dice-d20"></i>'),e+="</p>"}}return e}l(Cs,"parseMessages");function Ds(){let t=this.element.find(".window-content .content").find("input:not(.alert), select[data-type]").toArray(),e={};for(let s of t){let r={...s.dataset,value:s.value};if(r.type==="combo"&&r.input==="false"){let n=s.previousElementSibling;r.value=n.value,r.optionData=n.selectedOptions[0].dataset}r.type==="select"&&(r.optionData=s.selectedOptions[0].dataset),e[r.daily]??={},e[r.daily][r.row]=r}return e}l(Ds,"getFields");var L=T("interface"),Es="Compendium.pf2e.classfeatures.Item.Klb35AwlkNrq1gpB",me=class extends Application{constructor(e,s){super(s),this._actor=e,this._dailies=[],this._dailyArgs={},this._saved={},this._children={},this._custom={},this._predicate={},this._rows={}}static get defaultOptions(){return mergeObject(super.defaultOptions,{id:"pf2e-dailies-interface",template:K("interface.hbs"),height:"auto",width:400,submitOnClose:!1,submitOnChange:!1,dragDrop:[{dropSelector:'[data-droppable="true"]'}]})}get actor(){return this._actor}get dailies(){return this._dailies}get dailyArgs(){return this._dailyArgs}get saved(){return this._saved}get children(){return this._children}get custom(){return this._custom}get predicate(){return this._predicate}get rows(){return this._rows}async getData(e){let s=[],r=this._actor;if(this._dailies=Dt(r),r.familiar){let i="dailies.familiar",a=T("label"),c=r.attributes.familiarAbilities.value,u=Ae(),d=x(r,i)??{},p={label:a("familiar"),rows:[]},m=u.index.map(({_id:f,name:h})=>({value:f,label:h})),y=F("familiar").split(",");for(let f of y){f=f.trim();let h=await fromUuid(f);h&&h.isOfType("action")&&m.push({value:f,label:h.name})}m.sort((f,h)=>f.label.localeCompare(h.label));for(let f=0;f<c;f++)p.rows.push({label:a("ability",{nb:f+1}),value:d[`${f}`]??"",order:100,options:m,data:{type:"select",daily:i,row:f.toString(),unique:"ability"}});p.rows.length&&(this._rows[i]=p.rows.reduce((f,{data:h})=>(f[h.row]={save:!0},f),{}),s.push(p))}{let i=Fe(r);if(i?.uses.value){let a="dailies.rations",c="rations",{value:u,max:d}=i.uses,m=(i.quantity-1)*d+u,y=m<=1,f=[{value:"false",label:L("rations.no")},{value:"true",label:y?L("rations.last"):L("rations.yes",{nb:m})}];s.push({label:i.name,rows:[{label:"",order:200,value:"false",options:f,data:{type:"select",daily:a,row:c}}]}),this._rows[a]={[c]:{save:!1}}}}if(!W()){let i,a;if((i=bt(r)).length&&(a=ce(r))){let c="dailies.staff",u=x(r,c)??{},d=i.map(y=>({value:y.id,label:y.name}));d.sort((y,f)=>y.label.localeCompare(f.label));let p={label:L("staves.prepare"),rows:[{label:L("staves.staff"),value:u.staffID??"",order:100,options:d,data:{type:"select",daily:c,row:"staffID"}}]};this._rows[c]={staffID:{save:!0}};let m=wt(r);if(m.length){m.sort((b,g)=>b.rank===g.rank?b.spell.name.localeCompare(g.spell.name):b.rank-g.rank);let y=m.map(({spell:b,rank:g,index:v})=>({value:b.id,label:`${b.name} (${R.spellRankLabel(g)})`,data:{rank:g,unique:`${b.id}.${g}.${v}`}}));y.unshift({value:"",label:""});let f=B(r,Es,"feat"),h=f&&r.level>=8?r.level>=16?3:2:1;f&&(p.rows.push({label:L("staves.type"),value:u.makeshift??"false",order:100,options:[{value:"false",label:"Regular Staff"},{value:"true",label:"Makeshift Staff"}],data:{type:"select",daily:c,row:"makeshift"}}),this._rows[c].makeshift={save:!0});for(let b=1;b<=h;b++)p.rows.push({label:L("staves.expend"),value:"",order:100,options:y,data:{type:"select",daily:c,row:`expend${b}`,unique:"expend"}}),this._rows[c][`expend${b}`]={save:!1}}s.push(p)}}for(let i of this._dailies)try{let a=await Ft.call(this,i);s.push(a)}catch(a){L.error("error.unexpected"),console.error(a),console.error(`The error occured during templating of ${i.key}`)}let n=[],o=[];for(let i of s)i.rows.length>1?o.push(i):i.rows.length&&n.push(i);return n.sort((i,a)=>a.rows[0].order-i.rows[0].order),o.sort((i,a)=>i.rows.length-a.rows.length),mergeObject(super.getData(e),{i18n:L,dump:({value:i,placeholder:a,data:c})=>{let u="";return i&&(u+=` value="${i}"`),a&&(u+=` placeholder="${a}"`),typeof c=="object"&&Object.entries(c).forEach(([d,p])=>u+=` data-${d}="${p}"`),u&&(u+=" "),u},rows:n,groups:o,hasDailies:n.length||o.length})}render(e,s){return this._randomInterval&&clearInterval(this._randomInterval),this.element.find("select.random")&&(this._randomInterval=setInterval(()=>{this.element.find("select.random").each((n,o)=>{o.selectedIndex=(o.selectedIndex+1)%o.options.length})},2e3)),super.render(e,s)}close(e){return this._randomInterval&&clearInterval(this._randomInterval),super.close(e)}activateListeners(e){super.activateListeners(e),e.find("[data-action=clear]").on("click",this.#u.bind(this)),e.find("[data-action=accept]").on("click",this.#c.bind(this)),e.find("[data-action=cancel]").on("click",this.#d.bind(this)),e.find(".combo select").on("change",this.#n.bind(this)),e.find(".combo input").on("change",this.#i.bind(this)),e.find("[data-action=search]").on("click",this.#r.bind(this)),e.find("[data-action=alert]").on("click",this.#e.bind(this));let s=e.find("select[data-unique]");s.on("change",r=>this.#o(r.currentTarget,!0));{let r=[];for(let n of s){let{unique:o,daily:i}=n.dataset,a=`${i}.${o}`;r.includes(a)||(r.push(a),this.#o(n,!1))}}}_canDragDrop(e){return!0}async _onDrop(e){let s=T("interface.error.drop"),r=e.target;r instanceof HTMLLabelElement&&(r=r.nextElementSibling);try{let n=e.dataTransfer?.getData("text/plain"),o=JSON.parse(n);if(!o||o.type!=="Item"||typeof o.uuid!="string")return s.warn("wrongDataType");let i=await fromUuid(o.uuid);if(!i)return s.warn("wrongDataType");let a=await this.#s(r);if(!a)return pe(i,r);a.type==="feat"?Lt.call(this,i,r,a):a.type==="spell"?_t.call(this,i,r,a):pe(i,r)}catch(n){s.error("error.unexpected"),console.error(n),console.error("The error occured during _onDrop")}}async#e(e){e.preventDefault(),this.#t();let s=e.currentTarget.dataset,r=this.rows[s.daily][s.row],n=this.dailyArgs[s.daily],o;try{o=await r.fix(n)}catch(i){L.error("error.unexpected"),console.error(i),console.error(`The error occured during an alert fix of '${s.daily}'`)}this.#a(),o&&this.render()}async#r(e){e.preventDefault();let s=await this.#s(e.currentTarget,!0);s?game.pf2e.compendiumBrowser.openTab(s.type,s.search):game.pf2e.compendiumBrowser.render(!0)}async#s(e,s){let{daily:r,row:n}=e.dataset,o=this.rows[r]?.[n]?.filter,i=this.dailyArgs[r];if(!(!i||!o))return typeof o.search=="function"&&(o.search=await o.search(i)),s?Rt.call(this,o):o}#n(e){let s=e.currentTarget,r=s.nextElementSibling;r.dataset.input="false",r.value=s.options[s.selectedIndex].text}#i(e){let s=e.currentTarget,r=s.previousElementSibling,n=s.value.toLowerCase(),i=Array.from(r.options).map(a=>a.value).indexOf(n);i!==-1?(r.value=n,s.value=r.options[i].text,s.dataset.input="false"):(r.value="",s.dataset.input="true")}#t(){this.element.addClass("disabled")}#a(){this.element.removeClass("disabled")}#l(){let e=[],s=this.element.find("input").filter((n,o)=>!o.value),r=this.element.find("input.alert");return s.length&&e.push("error.empty"),r.length&&e.push("error.unattended"),e.forEach(n=>L.warn(n)),!e.length}async#c(e){e.preventDefault(),this.#l()&&(this.#t(),await Nt.call(this),this.close())}#u(e){e.preventDefault();let s=$(e.currentTarget),r=s.prevAll("input").first();r.val(""),r.attr("value",""),r.attr("data-uuid",""),s.addClass("disabled")}#d(e){e.preventDefault(),this.close()}#o(e,s){let r=e.dataset.unique,n=s?[e,...Os(e,`select[data-unique="${r}"]`)]:e.parentElement.querySelectorAll(`:scope > select[data-unique="${r}"]`),o=new Set;for(let i of n){let a=i.selectedIndex,c=i.options,u=l(()=>{let y=c[a];return y.dataset.unique??y.value},"optionUniqueValue"),d=l(()=>{let y=u();return y&&o.has(y)},"optionExists");for(;d()&&a>0;)a-=1;let p=i.options.length-1;for(;d()&&a<p;)a+=1;if(d())continue;let m=u();m&&o.add(m),i.selectedIndex!==a&&(i.selectedIndex=a)}for(let i of n){let a=i.selectedIndex,c=i.options;for(let u=0;u<c.length;u++){if(u===a)continue;let d=c[u];d.disabled=o.has(d.dataset.unique??d.value)}}}};l(me,"DailiesInterface");function Os(t,e){let s=[],r=t.parentElement;if(!r)return s;let n=e?r.querySelectorAll(`:scope > ${e}`):r.children;for(let o of n)o!==t&&s.push(o);return s}l(Os,"getSiblings");function $t(t,e){x(t,"isWatch")&&e.find(".message-content button").on("click",()=>te())}l($t,"renderChatMessage");function Mt(){let t=`<div>${S("message.dailiesRequest.content")}</div>`;t+=`<button type="button" style="margin-top: 8px;">${S("message.dailiesRequest.button")}</button>`,nt().create({content:t,flags:{[w]:{isWatch:!0}}})}l(Mt,"createWatchChatMessage");var As="tLa4bewBhyqzi6Ow",Fs={1:"RjuupS9xyXDLgyIr",2:"Y7UD64foDbDMV9sx",3:"ZmefGBXGJF3CFDbn",4:"QSQZJ5BC3DeHv153",5:"tjLvRWklAylFhBHQ",6:"4sGIy77COooxhQuC",7:"fomEZZ4MxVVK3uVu",8:"iPki3yuoucnj7bIt",9:"cFHomF3tty8Wi1e5",10:"o1XIHJ4MJyroAHfF"},Ts={1:"UJWiN0K3jqVjxvKk",2:"vJZ49cgi8szuQXAD",3:"wrDmWkGxmwzYtfiA",4:"Sn7v9SsbEDMUIwrO",5:"5BF7zMnrPYzyigCs",6:"kiXh4SUWKr166ZeM",7:"nmXPj9zuMRQBNT60",8:"Qs8RgNH6thRPv2jt",9:"Fgv722039TVM5JTc"},Rs={cantripDeck5:"PF2E.Item.Physical.FromSpell.CantripDeck5",scroll:"PF2E.Item.Physical.FromSpell.Scroll",wand:"PF2E.Item.Physical.FromSpell.Wand"},Ps=new Set(["arcane","divine","occult","primal"]);async function Je(t,e,{heightenedLevel:s,mystified:r=!1,temp:n=!1,itemName:o,itemImg:i}){let a=await fromUuid(t);if(!a)return null;s??=a.baseRank,(!o||typeof o!="string")&&(o??=e);let c=game.packs.find(f=>f.collection==="pf2e.equipment-srd"),u=Ls(e,s),d=await c?.getDocument(u??"");if(!at(d,"ConsumablePF2e"))return null;let p={...d.toObject(),_id:null},m=p.system.traits;m.value=Array.from(new Set([...m.value,...a.traits])),m.rarity=a.rarity,m.value.includes("magical")&&m.value.some(f=>Ps.has(f))&&m.value.splice(m.value.indexOf("magical"),1),m.value.sort(),p.name=_s(o,a.name,s);let y=p.system.description.value;return p.system.description.value=(()=>{let f=document.createElement("p");f.append(a.sourceId?`@UUID[${a.sourceId}]{${a.name}}`:a.description);let h=document.createElement("div"),b=document.createElement("hr");return h.append(f,b),b.insertAdjacentHTML("afterend",y),h.innerHTML})(),e!=="cantripDeck5"&&(p.system.spell=a.clone({"system.location.heightenedLevel":s}).toObject()),r&&(p.system.identification.status="unidentified"),typeof i=="string"&&(p.img=i),p.system.temporary=n,p}l(Je,"createConsumableFromSpell");function Ls(t,e){switch(t){case"cantripDeck5":return As;case"scroll":return Fs[e]??null;default:return Ts[e]??null}}l(Ls,"getIdForSpellConsumable");function _s(t,e,s){let r=Rs[t]||`${t} of {name} (Level {level})`;return game.i18n.format(r,{name:e,level:s})}l(_s,"getNameForSpellConsumable");var Ut="max(1,floor(@actor.level/2))",Ns=["propertyRune1","propertyRune2","propertyRune3","propertyRune4"],jt,zt,R={get skillNames(){return jt??=Object.keys(CONFIG.PF2E.skillList).filter(t=>t!=="lore"),jt.slice()},skillLabel:t=>game.i18n.localize(CONFIG.PF2E.skillList[t]),createSkillRuleElement:({skill:t,value:e,mode:s="upgrade",predicate:r})=>{let n={key:"ActiveEffectLike",mode:s,path:`system.skills.${t}.rank`,value:e};return r&&r.length&&(n.predicate=r),n},createLoreSource:({name:t,rank:e})=>({type:"lore",img:"systems/pf2e/icons/default-icons/lore.svg",name:t,system:{proficient:{value:e}}}),get languageNames(){return zt??=Object.keys(CONFIG.PF2E.languages),zt.slice()},languageLabel:t=>game.i18n.localize(CONFIG.PF2E.languages[t]),createLanguageRuleElement:({language:t,mode:e="add",predicate:s})=>{let r={key:"ActiveEffectLike",mode:e,path:"system.traits.languages.value",value:t};return s&&s.length&&(r.predicate=s),r},resistanceLabel:(t,e)=>{let s=game.i18n.localize(`PF2E.Trait${xe(t)}`);return e&&(s+=` ${e}`),s},createResistanceRuleElement:({type:t,value:e,predicate:s})=>{e==="half"&&(e=Ut);let r={key:"Resistance",type:t,value:e};return s&&s.length&&(r.predicate=s),r},createFeatSource:async t=>{let e=(await fromUuid(t))?.toObject();if(!e)throw new Error(`An error occured while trying to create a feat source with uuid: ${t}`);return e},createSpellScrollSource:async({uuid:t,level:e,itemName:s,itemImg:r})=>{let n=await Je(t,"scroll",{heightenedLevel:e,temp:!0,itemName:s,itemImg:r});if(!n)throw new Error(`An error occured while trying to create a spell scroll source with uuid: ${t}`);return n},createWandSource:async({uuid:t,level:e,itemName:s,itemImg:r})=>{let n=await Je(t,"wand",{heightenedLevel:e,temp:!0,itemName:s,itemImg:r});if(!n)throw new Error(`An error occured while trying to create a wand source with uuid: ${t}`);return n},createSpellSource:async t=>{let e=(await fromUuid(t))?.toObject();if(!e)throw new Error(`An error occured while trying to create a spell source with uuid: ${t}`);return e},spellRankLabel:t=>game.i18n.format("PF2E.Item.Spell.Rank.Ordinal",{rank:$s(t)}),get halfLevelString(){return Ut},getChoiSetRuleSelection:(t,e)=>t._source.system.rules.find(n=>n.key==="ChoiceSet"&&(!e||n.rollOption===e))?.selection,proficiencyLabel:t=>game.i18n.localize(CONFIG.PF2E.proficiencyLevels[t]),randomOption:async t=>{let e=(await new Roll(`1d${t.length}`).evaluate({async:!0})).total,s=t[e-1];return typeof s=="string"?s:s.value},halfLevelValue:t=>Math.max(1,Math.floor(t.level/2)),sequenceArray:ke,damageLabel:t=>game.i18n.localize(CONFIG.PF2E.damageTypes[t]),weaponTraitLabel:t=>game.i18n.localize(CONFIG.PF2E.weaponTraits[t]),weaponPropertyRunesLabel:t=>{let e=`PF2E.WeaponPropertyRune.${t}.Name`;return game.i18n.localize(e)},hasFreePropertySlot:t=>{let e=t.system.runes.potency;return e>0&&t.system.runes.property.length<e},getFreePropertyRuneSlot:t=>{let e=t.system.potencyRune.value;if(e===null)return null;for(let s=0;s<e;s++){let r=Ns[s];if(!t.system[r].value)return r}return null},getPlayersActors:(t,...e)=>{e.length||(e=["creature"]);let s=game.actors;if(t){let r=F("members")?Array.from(t.parties??[]).flatMap(n=>n.members):null;r?s=r:s=s.filter(n=>n.hasPlayerOwner),t instanceof Actor&&(s=s.filter(n=>n!==t))}else s=s.filter(r=>r.hasPlayerOwner);return s.filter(r=>r.isOfType(...e))}};function $s(t){let e=new Intl.PluralRules(game.i18n.lang,{type:"ordinal"}),s=game.i18n.localize(`PF2E.OrdinalSuffixes.${e.select(t)}`);return game.i18n.format("PF2E.OrdinalNumber",{value:t,suffix:s})}l($s,"ordinalString");function te(t){if((!t||!t.isOfType("character")||!t.isOwner)&&(t=canvas.tokens.controlled.find(s=>s.actor?.isOfType("character")&&s.actor.isOwner)?.actor,t||(t=game.user.character)),!t||!t.isOfType("character")||!t.isOwner)return C("error.noCharacterSelected");if(x(t,"rested")!==!0)return C("error.unrested");new me(t,{title:S("interface.title",{name:t.name})}).render(!0)}l(te,"openDailiesInterface");function Wt(){if(!game.user.isGM)return C("error.notGM");Mt()}l(Wt,"requestDailies");function Le(){let t=new Collection;return[t,e=>{let s=e._id;if(!s)return;let r=t.get(s)??{};t.set(s,mergeObject(r,e))}]}l(Le,"createUpdateCollection");async function Gt(){let t=(await this.getCraftingEntries()).filter(n=>n.isDailyPrep),s=t.filter(n=>n.isAlchemical).reduce((n,o)=>n+o.reagentCost,0),r=(this.system.resources.crafting.infusedReagents.value||0)-s;if(r<0){ui.notifications.warn(game.i18n.localize("PF2E.CraftingTab.Alerts.MissingReagents"));return}else await this.update({"system.resources.crafting.infusedReagents.value":r});for(let n of t)for(let o of n.preparedCraftingFormulas){let i=o.item.toObject();i.system.quantity=o.quantity,i.system.temporary=!0,i.system.size=this.ancestry?.size==="tiny"?"tiny":"med",n.isAlchemical&&(i.type==="consumable"||i.type==="weapon"||i.type==="equipment")&&i.system.traits.value.push("infused"),await this.addToInventory(i)}}l(Gt,"onPerformDailyCrafting");function qt(t,e){let s=t.actor;if(!s.isOwner)return;e.find("aside .sidebar .hitpoints .hp-small").append(`<a class="roll-icon dailies" data-tooltip="${S("sheet.title")}"><i class="fas fa-mug-saucer"></i></a>`).find(".dailies").on("click",()=>te(s)),W()||Ms(e,s)}l(qt,"renderCharacterSheetPF2e");function Ms(t,e){let r=t.find(".sheet-body .sheet-content [data-tab=spellcasting] .spellcastingEntry-list").find("[data-container-type=spellcastingEntry]:not([data-container-id=rituals])");for(let n of r){let o=n.dataset.containerId,i=e.spellcasting.get(o),a=oe(i);if(!a)continue;let c=$(`<div class="pf2e-dailies-charges"><label>${S("staves.label")}</label></div>`),u=$(`<input type="number" min="0" max="${a.max}" value="${a.charges}">`);u.on("change",m=>js(m,e));let d=$('<a><i class="fas fa-redo"></i></a>');d.on("click",m=>Us(m,e)),c.append(u),c.append(d),n.querySelector(".spell-ability-data .statistic-values").after(c[0]);let p=n.querySelectorAll('.spell-list .spell:not([data-slot-level="0"]');for(let m of p){let y=m.dataset.slotLevel;a.canPayCost(y)||(m.dataset.expendedState=!0)}}}l(Ms,"renderStavesEntries");function Bt(t,e){let{itemId:s}=t.currentTarget.closest(".spellcasting-entry").dataset;return e.spellcasting.get(s)}l(Bt,"getEntryDataFromEvent");async function Us(t,e){let s=Bt(t,e);le(s,9999)}l(Us,"onStaffChargesReset");async function js(t,e){let s=Bt(t,e);le(s,t.currentTarget.valueAsNumber)}l(js,"onStaffChargesChange");var Vt=["/** @typedef {'flexibility' | 'improved'} FlexibilityRow */","/** @typedef {'improved'} FlexibilityChild */","/** @typedef {[FlexibilityRow, {}, FlexibilityChild]} FlexibilityGenerics */","","/**"," * @param {FlexibilityRow} slug"," * @param {number} level"," * @param {FlexibilityChild} [child]"," */","function createRow(slug, level, child) {","    /** @type {DailyRowDrop<FlexibilityGenerics>} */","    const row = {","        type: 'drop',","        label: `PF2E.Level${level}`,","        slug,","        filter: {","            type: 'feat',","            search: {","                category: ['class'],","                traits: {","                    values: ['fighter'],","                },","                level,","            },","        },","    }","    if (child) row.childPredicate = [child]","    return row","}","","/** @type {Daily<FlexibilityGenerics>} */","const combatFlexibility = {","    key: 'flexibility',","    item: {","        uuid: 'Compendium.pf2e.classfeatures.Item.8g6HzARbhfcgilP8', // Combat Flexibility","    },","    children: [","        {","            slug: 'improved',","            uuid: 'Compendium.pf2e.classfeatures.Item.W2rwudMNcAxs8VoX', // Improved Flexibility","        },","    ],","    rows: [","        createRow('flexibility', 8), //","        createRow('improved', 14, 'improved'),","    ],","    process: async ({ utils, fields, addFeat, messages, children }) => {","        const uuid = fields.flexibility.uuid","        const source = await utils.createFeatSource(uuid)","        addFeat(source)","        messages.add('feats', { uuid })","","        if (children.improved) {","            const uuid = fields.improved.uuid","            const source = await utils.createFeatSource(uuid)","            addFeat(source, children.improved)","            messages.add('feats', { uuid })","        }","    },","}","","return combatFlexibility"].join(`
`);var Ht=["/** @typedef {'alert' | 'smith' | 'mental' | 'runic' | 'advanced'} MindRow */","/** @typedef {'weapon' | 'mental' | 'runic' | 'advanced'} MindChild */","/** @typedef {[MindRow, {}, MindChild]} MindGenerics */","","const MIND_WEAPON_UUID = 'Compendium.pf2e-dailies.equipment.Item.VpmEozw21aRxX15P'","","const WEAPON_BASE_TYPES = {","    0: { die: 'd4', traits: ['finesse', 'agile'], usage: 'held-in-one-hand' },","    1: { die: 'd6', traits: ['finesse'], usage: 'held-in-one-hand' },","    2: { die: 'd8', traits: [], usage: 'held-in-one-hand' },","    3: { die: 'd10', traits: ['reach'], usage: 'held-in-two-hands' },","}","","const WEAPON_GROUPS = /** @type {Record<WeaponDamage, string>} */ {","    slashing: 'sword',","    piercing: 'spear',","    bludgeoning: 'club',","}","","const WEAPON_TRAITS = ['grapple', 'nonlethal', 'shove', 'trip', 'modular']","","const WEAPON_DAMAGE_TYPES = Object.keys(WEAPON_GROUPS)","","const WEAPON_RUNES = ['corrosive', 'disrupting', 'flaming', 'frost', 'shock', 'thundering']","","const WEAPON_GREATER_RUNES = [","    'anarchic',","    'axiomatic',","    'greaterCorrosive',","    'greaterDisrupting',","    'greaterFlaming',","    'greaterFrost',","    'greaterShock',","    'greaterThundering',","    'holy',","    'unholy',","]","","/** @type {Daily<MindGenerics>} */","const mindSmith = {","    key: 'mindsmith',","    item: {","        uuid: 'Compendium.pf2e.feats-srd.Item.juikoiIA0Jy8PboY', // Mind Smith Dedication","    },","    children: [","        {","            slug: 'weapon',","            uuid: MIND_WEAPON_UUID, // Mind Weapon","        },","        {","            slug: 'mental',","            uuid: 'Compendium.pf2e.feats-srd.Item.PccekOihIbRWdDky', // Malleable Mental Forge","        },","        {","            slug: 'runic',","            uuid: 'Compendium.pf2e.feats-srd.Item.2uQbQgz1AbjzcFSp', // Runic Mind Smithing","        },","        {","            slug: 'advanced',","            uuid: 'Compendium.pf2e.feats-srd.Item.fgnfXwFcn9jZlXGD', // Advanced Runic Mind Smithing","        },","    ],","    rows: [","        {","            type: 'alert',","            slug: 'alert',","            message: 'Missing Mind Weapon',","            fix,","            childPredicate: [{ not: 'weapon' }],","        },","        {","            type: 'select',","            slug: 'smith',","            label: 'Mind Smith',","            options: WEAPON_DAMAGE_TYPES,","            labelizer: ({ utils }) => utils.damageLabel,","            childPredicate: ['weapon'],","        },","        {","            type: 'select',","            slug: 'mental',","            label: 'Mental Forge',","            options: WEAPON_TRAITS,","            labelizer: ({ utils }) => utils.weaponTraitLabel,","            childPredicate: ['weapon', 'mental'],","        },","        {","            type: 'select',","            slug: 'runic',","            label: 'Runic Smithing',","            options: WEAPON_RUNES,","            labelizer: ({ utils }) => utils.weaponPropertyRunesLabel,","            childPredicate: ['weapon', 'runic', { not: 'advanced' }],","            condition: ({ children, utils }) => utils.hasFreePropertySlot(children.weapon),","        },","        {","            type: 'select',","            slug: 'advanced',","            label: 'Runic Smithing',","            options: WEAPON_GREATER_RUNES,","            labelizer: ({ utils }) => utils.weaponPropertyRunesLabel,","            childPredicate: ['weapon', 'advanced'],","            condition: ({ children, utils }) => utils.hasFreePropertySlot(children.weapon),","        },","    ],","    process: ({ children, updateItem, fields, messages, item, utils }) => {","        const weapon = children.weapon","        if (!weapon) return","","        messages.addGroup('mindsmith')","","        const selected = /** @type {WeaponDamage} */ fields.smith.value","        updateItem({ _id: weapon.id, 'system.damage.damageType': selected, 'system.group': WEAPON_GROUPS[selected] })","        messages.add('mindsmith', { selected: utils.damageLabel(selected), uuid: item.uuid, label: 'mindsmith' })","","        if (children.mental) {","            const selected = fields.mental.value","            const traits = deepClone(weapon._source.system.traits?.value ?? [])","            if (!traits.includes(selected)) traits.push(selected)","            updateItem({ _id: weapon.id, 'system.traits.value': traits })","            messages.add('mindsmith', {","                selected: utils.weaponTraitLabel(selected),","                uuid: children.mental.uuid,","                label: 'mentalforge',","            })","        }","","        if ((children.advanced || children.runic) && utils.hasFreePropertySlot(weapon)) {","            const child = children.advanced ?? children.runic","            const freeSlot = utils.getFreePropertyRuneSlot(weapon)","            const field = fields.advanced ?? fields.runic","            const selected = field.value","","            if (!weapon.system.runes.property.includes(selected)) {","                updateItem({ _id: weapon.id, [`system.${freeSlot}.value`]: selected, [`flags.world.runeSlot`]: freeSlot })","                messages.add('mindsmith', {","                    selected: utils.weaponPropertyRunesLabel(selected),","                    uuid: child.uuid,","                    label: 'runicmind',","                })","            }","        }","    },","    rest: ({ item, sourceId, updateItem }) => {","        if (sourceId !== MIND_WEAPON_UUID) return","","        let traits = item._source.system.traits?.value ?? []","        traits = traits.filter(trait => !WEAPON_TRAITS.includes(trait))","        updateItem({ _id: item.id, 'system.traits.value': traits })","","        const runeSlot = item.getFlag('world', 'runeSlot')","        if (runeSlot) {","            updateItem({ _id: item.id, [`system.${runeSlot}.value`]: null, [`flags.world.-=runeSlot`]: true })","        }","    },","}","","const OPTIONS = {","    0: 'A one-handed weapon that deals <strong>1d4</strong> damage and has the <strong>agile</strong> and <strong>finesse</strong> traits',","    1: 'A one-handed weapon that deals <strong>1d6</strong> damage and has the <strong>finesse</strong> trait',","    2: 'A one-handed weapon that deals <strong>1d8</strong> damage',","    3: 'A two-handed weapon that deals <strong>1d10</strong> damage and has the <strong>reach</strong> trait',","}","","/** * @param {DailyValueArgs<MindGenerics>} args */","async function fix({ actor }) {","    let content =","        `<p>This character doesn't have a mind weapon in their inventory.</p><p>Please select one of the following options to create one.</p>`","","    for (const [key, label] of Object.entries(OPTIONS)) {","        content += `<label><input type='radio' name='type' value='${key}'>${label}</label>`","    }","","    const weapon = await Dialog.wait(","        {","            title: 'Mind Weapon',","            content,","            buttons: {","                yes: {","                    icon: `<i class='fas fa-save'></i>`,","                    label: 'Accept',","                    callback: onWeaponSelected,","                },","                no: {","                    icon: `<i class='fas fa-times'></i>`,","                    label: 'Cancel',","                    callback: () => null,","                },","            },","            close: () => null,","        },","        {},","        { id: 'pf2e-dailies-weapon', width: 600 }","    )","","    if (weapon) {","        await actor.createEmbeddedDocuments('Item', [weapon])","        return true","    }","","    return false","}","","/** @params {JQuery} html */","async function onWeaponSelected(html) {","    const selection = html.find('[name=type]:checked').val()","    if (!selection) {","        ui.notifications.warn('You must select one weapon base type.')","        return","    }","","    const weapon = (await fromUuid(MIND_WEAPON_UUID))?.toObject()","    if (!weapon) {","        ui.notifications.warn(`The weapon couldn't be found in the compendium.`)","        return","    }","","    const stats = WEAPON_BASE_TYPES[selection]","","    setProperty(weapon, 'system.damage.die', stats.die)","    setProperty(weapon, 'system.traits.value', stats.traits.slice())","    setProperty(weapon, 'system.usage.value', stats.usage)","","    return weapon","}","","return mindSmith"].join(`
`);var Yt=["/** @typedef {'first' | 'second' | 'third' | 'fourth'} SavantRow */","/** @typedef {Record<SavantRow, { level: number; condition: boolean }>} SavantCustom */","/** @typedef {[SavantRow, SavantCustom, '']} SavantGenerics */","","const ROWS = /** @type {const} */ (['first', 'second', 'third', 'fourth'])","","/**"," * @param {CharacterPF2e} actor"," * @param {MagicTradition} tradition"," */","function getSpellcastingTraditionDetails(actor, tradition) {","    let maxSlot = 1","    let maxTradition = 0","","    for (const entry of actor.spellcasting.regular) {","        if ('pf2e-staves' in entry.flags) continue // we skip staff entries","","        const slots = entry.system.slots","        for (const key in slots) {","            const slot = slots[key]","            if (slot.max) maxSlot = Math.max(maxSlot, Number(key.slice(4)))","        }","","        if (entry.tradition === tradition) maxTradition = Math.max(maxTradition, entry.rank)","    }","","    return { maxSlot: Math.min(maxSlot, 10), maxTradition }","}","","/** @type {Daily<SavantGenerics>} */","const scrollSavant = {","    key: 'savant',","    item: {","        uuid: 'Compendium.pf2e.feats-srd.Item.u5DBg0LrBUKP0JsJ', // Scroll Savant","    },","    prepare: ({ actor }) => {","        const { maxSlot, maxTradition } = getSpellcastingTraditionDetails(actor, 'arcane')","        return {","            first: { level: maxSlot - 2, condition: true },","            second: { level: maxSlot - 3, condition: true },","            third: { level: maxSlot - 4, condition: maxTradition >= 3 && maxSlot >= 5 },","            fourth: { level: maxSlot - 5, condition: maxTradition >= 4 && maxSlot >= 6 },","        }","    },","    rows: ROWS.map(rowName => {","        /** @type {DailyRowDrop<SavantGenerics>} */","        const row = {","            type: 'drop',","            slug: rowName,","            label: ({ custom }) => `PF2E.SpellLevel${custom[rowName].level}`,","            filter: {","                type: 'spell',","                search: ({ custom }) => ({","                    category: ['spell'],","                    traditions: ['arcane'],","                    level: custom[rowName].level,","                }),","            },","            condition: ({ custom }) => custom[rowName].condition,","        }","        return row","    }),","    process: async ({ utils, fields, custom, addItem, messages }) => {","        for (const field of Object.values(fields)) {","            const uuid = field.uuid","            const source = await utils.createSpellScrollSource({ uuid, level: custom[field.row].level })","            addItem(source)","            messages.add('scrolls', { uuid, label: source.name })","        }","    },","}","","return scrollSavant"].join(`
`);var Xt=["/** @typedef {typeof ROWS[number]} TomeRow */","/** @typedef {'adept' | 'second' | 'intense' | 'paragon'} TomeChild */","/** @typedef {Record<TomeRow, { rank: OneToFour; options: string[] }>} TomeCustom */","/** @typedef {[TomeRow, TomeCustom, TomeChild]} TomeGenerics */","","const ROWS = /** @type {const} */ (['first', 'second'])","","/** @param {'adept' | 'paragon'} option */","function createChildCondition(option) {","    /** @type { BaseDailyConditionFunction<TomeGenerics>} */","    const condition = ({ item, utils }) => {","        return utils.getChoiSetRuleSelection(item, option) === 'tome'","    }","    return condition","}","","/** @type {Daily<TomeGenerics>} */","const thaumaturgeTome = {","    key: 'tome',","    item: {","        uuid: 'Compendium.pf2e.classfeatures.Item.MyN1cQgE0HsLF20e', // Tome","    },","    children: [","        {","            slug: 'adept',","            uuid: 'Compendium.pf2e.classfeatures.Item.Obm4ItMIIr0whYeO', // Implement Adept","            condition: createChildCondition('adept'),","        },","        {","            slug: 'second',","            uuid: 'Compendium.pf2e.classfeatures.Item.ZEUxZ4Ta1kDPHiq5', // Second Adept","            condition: createChildCondition('adept'),","        },","        {","            slug: 'intense',","            uuid: 'Compendium.pf2e.feats-srd.Item.yRRM1dsY6jakEMaC', // Intense Implement","        },","        {","            slug: 'paragon',","            uuid: 'Compendium.pf2e.classfeatures.Item.QEtgbY8N2V4wTbsI', // Implement Paragon","            condition: createChildCondition('paragon'),","        },","    ],","    prepare: ({ utils, actor, children }) => {","        const skillNames = utils.skillNames","        const actorLevel = actor.level","        const actorSkills = /** @type {Record<SkillLongForm, { rank: ZeroToFour }>} */ (actor.skills)","","        /** @type {TomeCustom} */","        const custom = {","            first: { options: [], rank: 1 },","            second: { options: [], rank: 1 },","        }","","        // Implement Paragon","        if (children.paragon) {","            const skills = skillNames.filter(x => actorSkills[x].rank < 4)","            custom.first = { rank: 4, options: skills }","            custom.second = { rank: 4, options: skills }","        }","        // Intense Implement or Second Adept or Implement Adept","        else if (children.intense || children.adept || children.second) {","            const masters = skillNames.filter(x => actorSkills[x].rank < 3)","","            if (actorLevel >= 9) {","                custom.first = { rank: 3, options: masters }","                custom.second = { rank: 3, options: masters }","            } else {","                const experts = skillNames.filter(x => actorSkills[x].rank < 2)","                custom.first = { rank: 2, options: experts }","                custom.second = { rank: 3, options: masters }","            }","        }","        // Tome","        else {","            if (actorLevel >= 5) {","                const experts = skillNames.filter(x => actorSkills[x].rank < 2)","                custom.first = { rank: 2, options: experts }","                custom.second = { rank: 2, options: experts }","            } else if (actorLevel >= 3) {","                const trained = skillNames.filter(x => actorSkills[x].rank < 1)","                const experts = skillNames.filter(x => actorSkills[x].rank < 2)","                custom.first = { rank: 1, options: trained }","                custom.second = { rank: 2, options: experts }","            } else {","                const trained = skillNames.filter(x => actorSkills[x].rank < 1)","                custom.first = { rank: 1, options: trained }","                custom.second = { rank: 1, options: trained }","            }","        }","","        return custom","    },","    rows: ROWS.map(rowName => {","        /** @type {DailyRowCombo<TomeGenerics>} */","        const row = {","            type: 'combo',","            slug: rowName,","            label: ({ custom, utils }) => utils.proficiencyLabel(custom[rowName].rank),","            options: ({ custom }) => custom[rowName].options,","            labelizer: ({ utils }) => utils.skillLabel,","        }","        return row","    }),","    process: ({ custom, fields, utils, messages, addItem, addRule }) => {","        messages.addGroup('tome', 65)","","        for (const rowName of ROWS) {","            const rank = custom[rowName].rank","            let value = fields[rowName].value","","            if (fields[rowName].input === 'true') {","                const source = utils.createLoreSource({ name: value, rank })","                addItem(source)","            } else {","                const source = utils.createSkillRuleElement({ skill: value, value: rank })","                value = utils.skillLabel(value)","                addRule(source)","            }","","            messages.add('tome', { label: utils.proficiencyLabel(rank), selected: value })","        }","    },","}","","return thaumaturgeTome"].join(`
`);var G=T("customs"),zs=["default","trainedSkill","trainedLore","language","resistance","feat","spell"],Ze=["flexibility","savant","tome","mind"],ge=class extends FormApplication{static get defaultOptions(){return mergeObject(super.defaultOptions,{id:"pf2e-dailies-customs",title:G("title"),template:K("customs.hbs"),submitOnChange:!1,submitOnClose:!1,closeOnSubmit:!1,scrollY:[".left .list"]})}async _updateObject(e,s){}async getData(e){let s=F("customDailies"),r=s.find(a=>a.key===this._selectedDaily)?.code,n=this._selectedTemplate,o=game.modules.get("pf2e-dailies-ext"),i=o?.active&&isNewerVersion(Ke,o.version)?{version:Ke}:"";return mergeObject(super.getData(e),{i18n:G,template:n,templates:zs,daily:this._selectedDaily,code:r,customs:s,examples:Ze,isExample:Ze.includes(n),monaco:o?.active,newVersion:i})}activateListeners(e){super.activateListeners(e),this._monaco?.dispose();let s=game.modules.get("pf2e-dailies-ext")?.api,r=e.find(".code")[0];if(s&&r){let n=e.find(".monaco .placeholder")[0];this._monaco=s.createEditor(n,r.value),this._monaco.onDidChangeModelContent(debounce(()=>r.value=this._monaco.getValue(),200))}else this._monaco=null;e.find("[data-action=select-template]").on("change",this.#a.bind(this)),e.find("[data-action=create-template]").on("click",this.#i.bind(this)),e.find("[data-action=create-daily]").on("click",this.#s.bind(this)),e.find(".row[data-key]").on("click",this.#n.bind(this)),e.find("[data-action=delete-daily]").on("click",this.#r.bind(this)),e.find("[data-action=save-code]").on("click",this.#e.bind(this))}get code(){return this.form.querySelector(".window-content .code")?.value}async#e(e){e.preventDefault();let s=this.code,r=this._selectedDaily;if(!r||!s)return;let n=F("customDailies"),o=n.filter(i=>i.key!==r);try{let c=(await new be(s)()).key;if(typeof c!="string")return C("invalidKey");if(o.find(d=>d.key===c))return C("duplicate");let u=n.findIndex(d=>d.key===r);if(u<0)return;n.splice(u,1,{key:c,code:s}),await ve("customDailies",n),G.info("saved",{daily:c}),this._selectedDaily=c,this.render()}catch(i){z("error.unexpected"),console.error(i),console.error(`The error occured while testing the custom daily ${r}`)}}async#r(e){if(e.preventDefault(),e.stopPropagation(),!await Dialog.confirm({title:G("delete.title"),content:G("delete.content")}))return;let r=e.currentTarget.dataset.key,n=F("customDailies").filter(o=>o.key!==r);await ve("customDailies",n),G.info("deleted",{daily:r}),this.#s()}#s(){this._selectedDaily="",this._selectedTemplate="default",this.render()}#n(e){e.preventDefault(),this._selectedDaily=e.currentTarget.dataset.key,this.render()}async#i(e){e.preventDefault();let s=this._selectedTemplate,r=F("customDailies"),n=new FormData(this.form),o=Object.fromEntries(n),i=Ze.includes(s),{key:a,uuid:c,label:u}=o;if(i)a=s;else if(!a||!c)return G.warn("template.noEmpty");if(r.find(p=>p.key===a))return C("error.duplicate");let d;if(s==="trainedSkill"){let p=H(a,c,u);d=this.#t(p,{key:a,uuid:c,label:u},"SkillGenerics")}else if(s==="trainedLore"){let p=Ee(a,c,u);d=this.#t(p,{key:a,uuid:c,label:u},"SkillGenerics")}else if(s==="language"){let p=ne(a,c,u);d=this.#t(p,{key:a,uuid:c,label:u},"LanguageGenerics")}else if(s==="resistance"){let p=Qe(o.resistance),m=se(o.resistances);if(p===""||!m.length)return G.warn("template.noEmpty");if(typeof p=="number"&&p<1)return G.warn("template.badResistance");let y=ie(a,c,m,p,u);d=this.#t(y,{key:a,uuid:c,label:u,resistance:p,resistances:m},"ResistanceGenerics")}else if(s==="feat"){let p=se(o.traits),m={category:se(o.category),level:Qe(o.level)||{min:0,max:20}};p.length&&(m.traits=p);let y=Ce(a,c,m,u);d=this.#t(y,{key:a,uuid:c,label:u},"FeatGenerics")}else if(s==="spell"){let p=Number(o.level)||void 0,m=se(o.traits),y=o.levels.split(",").map(b=>b.trim());y.length===1?y=Qe(y[0]):y=y.filter(b=>b).map(b=>Number(b)).filter(b=>!isNaN(b));let f={category:se(o.category),traditions:se(o.traditions),level:y||[]};m.length&&(f.traits=m);let h=Ie(a,c,f,p,u);d=this.#t(h,{key:a,uuid:c,label:u,level:p},"SpellGenerics")}else if(s==="tome")d=Xt;else if(s==="flexibility")d=Vt;else if(s==="savant")d=Yt;else if(s==="mind")d=Ht;else{let p={key:a,label:u,item:{uuid:c},rows:[],process:()=>{}};d=this.#t(p,{key:a,uuid:c,label:u})}r.push({key:a,code:d}),await ve("customDailies",r),this._selectedDaily=a,this.render()}#t(e,s,r){let n="____PLACEHOLDER____",o=[],i=JSON.stringify(e,(u,d)=>typeof d=="function"?(o.push(d),n):d,4);i=i.replace(new RegExp('"'+n+'"',"g"),()=>o.shift()?.toString()?.replace(/( {5,})/g,d=>d.slice(4))??"");let a="";for(let[u,d]of Object.entries(s))typeof d=="string"?a+=`const ${u} = '${d}';
`:typeof d=="object"?a+=`const ${u} = ${JSON.stringify(d)};
`:a+=`const ${u} = ${d};
`;let c=r?`Daily<${r}>`:"Daily";return`${a}
/** @type {${c}} */
const daily = ${i};

return daily;`}#a(e){e.preventDefault(),this._selectedDaily="",this._selectedTemplate=e.currentTarget.value,this.render()}};l(ge,"DailyCustoms");function se(t){return t.split(",").map(e=>e.trim()).filter(e=>e)}l(se,"splitList");function Qe(t){if(typeof t=="number"||(t=t.trim(),t==="level"||t==="half"))return t;let e=Number(t);return isNaN(e)?"":e}l(Qe,"simplyfiable");async function Jt(t){let e=[],[s,r]=Le(),n=W();for(let o of t.items){if(x(o,"temporary")){if(e.push(o.id),o.isOfType("feat")){let u=x(o,"grantedBy");if(u){let p=`flags.pf2e.itemGrants.-=${Y(o.name,{camel:"dromedary"})}`;r({_id:u,[p]:!0})}}continue}if(!n&&o.isOfType("spellcastingEntry")&&o.system.prepared.value==="charge"){e.push(o.id);continue}let i=Se(o);if(i){let u=Et(i);u?.rest&&await u.rest({item:o,sourceId:i,updateItem:r,actor:t})}let a=deepClone(o._source.system.rules),c=!1;for(let u=a.length-1;u>=0;u--)w in a[u]&&(a.splice(u,1),c=!0);c&&r({_id:o.id,"system.rules":a})}s.size&&await t.updateEmbeddedDocuments("Item",s.contents),e.length&&await t.deleteEmbeddedDocuments("Item",e),await we(t,"rested",!0)}l(Jt,"restForTheNight");var Ke="1.3.0",Ws="CONFIG.PF2E.Item.documentClasses.spellcastingEntry.prototype.cast",Gs="CONFIG.PF2E.Actor.documentClasses.character.prototype.performDailyCrafting";Hooks.once("setup",()=>{Q({name:"customDailies",type:Array,default:[],config:!1,onChange:qe}),Q({name:"familiar",type:String,default:""}),Q({name:"watch",type:Boolean,default:!1,onChange:Zt}),Q({name:"members",type:Boolean,default:!0,scope:"client"}),Q({name:"staff-sort",tupe:String,default:"top",choices:["top","bottom"],scope:"client"}),rt({name:"customs",type:ge}),game.modules.get(w).api={openDailiesInterface:t=>te(t),requestDailies:Wt,getBuiltinDailies:()=>deepClone(Ge),getCustomDailies:()=>deepClone(fe),prepareDailies:Oe,checkCustomDaily:Be,getUtils:()=>deepClone(R),getSpellcastingEntryStaffFlags:ae,getSpellcastingEntryStaffData:oe,updateEntryCharges:le},F("watch")&&Zt(!0),W()||(CONFIG.PF2E.preparationType.charge="Charge",libWrapper.register(w,Ws,vt))});Hooks.once("ready",async()=>{if(W()&&C("staves.conflict",!0),await qe(),!game.modules.get("lib-wrapper")?.active&&game.user.isGM){C("error.noLibwrapper",!0);return}libWrapper.register(w,Gs,Gt,"OVERRIDE")});Hooks.on("pf2e.restForTheNight",Jt);Hooks.on("renderCharacterSheetPF2e",qt);function Zt(t){Hooks[t?"on":"off"]("renderChatMessage",$t)}l(Zt,"enableWatchHook");})();
//# sourceMappingURL=main.js.map
