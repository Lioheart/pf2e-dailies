(()=>{"use strict";let e="";function t(t,a,s){return t.getFlag(e,a)??s}function a(e){return e.getFlag("core","sourceId")}function s(e,t){const s=a(e);return!!s&&t.includes(s)}const n=String.raw`[\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Join_Control}]`,i=String.raw`[^\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Join_Control}]`,r=new RegExp(i,"gu"),o=String.raw`(?:${n})(?=${i})|(?:${i})(?=${n})`,l=String.raw`(?:${n})(?=${n})`,c=String.raw`\p{Lowercase_Letter}`,u=String.raw`\p{Uppercase_Letter}`,p=new RegExp(`(${c})(${u}${l})`,"gu"),d=/[^-\p{White_Space}\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Join_Control}]/gu,f=new RegExp(`${u}|(?:${o})${c}`,"gu");function m(e,{camel:t=null}={}){if("string"!=typeof e)return console.warn("Non-string argument passed to `sluggify`"),"";switch(t){case null:return e.replace(p,"$1-$2").toLowerCase().replace(/['â€™]/g,"").replace(r," ").trim().replace(/[-\s]+/g,"-");case"bactrian":{const t=m(e,{camel:"dromedary"});return t.charAt(0).toUpperCase()+t.slice(1)}case"dromedary":return e.replace(d,"").replace(/[-_]+/g," ").replace(f,((e,t)=>0===t?e.toLowerCase():e.toUpperCase())).replace(/\s+/g,"");default:throw Error("PF2e System | I don't think that's a real camel.")}}function y(e){return Array.isArray(e)?t=>s(t,e):t=>a(t)===e}function g(e,t){return t?t.flatMap((t=>e.itemTypes[t])):e.items}function h(e,t,a){return g(e,a).find(y(t))}function b(e,t,a,s){const n="string"==typeof t?t:"info",i="object"==typeof t?t:"object"==typeof a?a:void 0,r="boolean"==typeof t?t:"boolean"==typeof a?a:s??!1;ui.notifications.notify(v(e,i),n,{permanent:r})}function v(...t){let[a,s]=t;return a=`${e}.${a}`,s?game.i18n.format(a,s):game.i18n.localize(a)}function k(t){return game.i18n.has(`${e}.${t}`,!1)}function w(e){const t=(...t)=>v(`${e}.${t[0]}`,t[1]);return Object.defineProperties(t,{warn:{value:(...t)=>function(...e){const[t,a,s]=e;b(t,"warning",a,s)}(`${e}.${t[0]}`,t[1],t[2]),enumerable:!1,configurable:!1},info:{value:(...t)=>function(...e){const[t,a,s]=e;b(t,"info",a,s)}(`${e}.${t[0]}`,t[1],t[2]),enumerable:!1,configurable:!1},error:{value:(...t)=>function(...e){const[t,a,s]=e;b(t,"error",a,s)}(`${e}.${t[0]}`,t[1],t[2]),enumerable:!1,configurable:!1},has:{value:t=>k(`${e}.${t}`),enumerable:!1,configurable:!1}}),t}const C=["addedLanguage","trainedSkill","addedResistance","thaumaturgeTome"],S=[{type:"tricksterAce",category:"ace",uuids:["Compendium.pf2e.feats-srd.POrE3ZgBRdBL9MsW"]},{type:"thaumaturgeTome",category:"tome",uuids:["Compendium.pf2e.classfeatures.MyN1cQgE0HsLF20e","Compendium.pf2e.classfeatures.Obm4ItMIIr0whYeO","Compendium.pf2e.classfeatures.ZEUxZ4Ta1kDPHiq5","Compendium.pf2e.feats-srd.yRRM1dsY6jakEMaC","Compendium.pf2e.classfeatures.QEtgbY8N2V4wTbsI"]},{type:"addedResistance",category:"elementalist",uuids:["Compendium.pf2e.feats-srd.tx9pkrpmtqe4FnvS"]},{type:"addedResistance",category:"ganzi",uuids:["Compendium.pf2e.heritages.3reGfXH0S82hM7Gp"]},{type:"trainedLore",category:"study",uuids:["Compendium.pf2e.feats-srd.aLJsBBZzlUK3G8MW"]},{type:"trainedSkill",category:"ageless",uuids:["Compendium.pf2e.feats-srd.wylnETwIz32Au46y"]},{type:"trainedSkill",category:"longevity",uuids:["Compendium.pf2e.feats-srd.WoLh16gyDp8y9WOZ"]},{type:"trainedSkill",category:"memories",uuids:["Compendium.pf2e.feats-srd.ptEOt3lqjxUnAW62"]},{type:"trainedSkill",category:"studies",uuids:["Compendium.pf2e.feats-srd.9bgl6qYWKHzqWZj0"]},{type:"addedLanguage",category:"linguistics",uuids:["Compendium.pf2e.feats-srd.eCWQU16hRLfN1KaX"]},{type:"addedLanguage",category:"borts",uuids:["Compendium.pf2e.equipment-srd.iS7hAQMAaThHYE8g"]},{type:"combatFlexibility",category:"flexibility",uuids:["Compendium.pf2e.classfeatures.8g6HzARbhfcgilP8","Compendium.pf2e.classfeatures.W2rwudMNcAxs8VoX"]},{type:"scrollSavant",category:"savant",uuids:["Compendium.pf2e.feats-srd.u5DBg0LrBUKP0JsJ"]},{type:"scrollChain",category:"esoterica",uuids:["Compendium.pf2e.feats-srd.OqObuRB8oVSAEKFR","Compendium.pf2e.feats-srd.nWd7m0yRcIEVUy7O","Compendium.pf2e.feats-srd.LHjPTV5vP3MOsPPJ"]},{type:"scrollChain",category:"trickster",uuids:["Compendium.pf2e.feats-srd.ROAUR1GhC19Pjk9C","Compendium.pf2e.feats-srd.UrOj9TROtn8nuxPf","Compendium.pf2e.feats-srd.lIg5Gzz7W70jfbk1"]}],[x,L,T,A,F,O]=(()=>{const e=[],t={},a=[],s=[],n=[],i=[];for(const{type:r,category:o,uuids:l}of S){t[o]??=[],t[o].push(...l),e.push(...l.map(((e,t)=>[e,{type:r,category:o,index:t}]))),C.includes(r)&&i.push(...l);const c=l[0];c.includes("equipment-srd")?s.push(c):c.includes("heritages")?n.push(c):a.push(c)}return[new Map(e),s,a,n,i,t]})();function D(e){return O[e]}function E(e){return s(e,F)}function j(e,t){return e.type===t}function P(...t){return t=t.filter((e=>"string"==typeof e)),`modules/${e}/templates/${t.join("/")}`}function I(e,t){return t?`@UUID[${e}]{${t}}`:`@UUID[${e}]`}const M=["untrained","trained","expert","master","legendary"],R=(new Set(["arcane","divine","occult","primal"]),[]);async function U(e,t,a=!1){const s=(await fromUuid(e))?.toObject();if(!s)return null;!1===t&&(t=s.system.level.value);const n=function(e){return`Compendium.pf2e.equipment-srd.${_[e]}`}(t);R[t]??=await fromUuid(n);const i=R[t]?.toObject();if(!i)return null;s.system.location.heightenedLevel=t,i.name=`Scroll of ${s.name} (Level ${t})`,i.system.temporary=a,i.system.spell=s,i.system.traits.value.push(...s.system.traditions.value);const r=s.flags.core?.sourceId;return r&&(i.system.description.value=`${I(r)}\n<hr />${i.system.description.value}`),i}const _={1:"RjuupS9xyXDLgyIr",2:"Y7UD64foDbDMV9sx",3:"ZmefGBXGJF3CFDbn",4:"QSQZJ5BC3DeHv153",5:"tjLvRWklAylFhBHQ",6:"4sGIy77COooxhQuC",7:"fomEZZ4MxVVK3uVu",8:"iPki3yuoucnj7bIt",9:"cFHomF3tty8Wi1e5",10:"o1XIHJ4MJyroAHfF"},z=w("interface.message");async function B(s,n){let i="";const r={},o=s.find(".window-content .content").find("input, select").toArray(),l=o.some((e=>C.includes(e.dataset.type)))?function(e){return function(e,t,a){return g(e,["feat","equipment","heritage"]).filter(y(t))}(e,F)}(n):[],c=[],u=[],p=new Map,d=e=>{const t=e.id,a=p.get(t);if(a)return a;const s=deepClone(e._source.system.rules);for(let e=s.length-1;e>=0;e--)"pf2e-dailies"in s[e]&&s.splice(e,1);return p.set(t,s),s},f={languages:[],skills:[],tome:[],resistances:[],feats:[],scrolls:[],spells:[]};for(const t of o){const s=t.dataset.type;if("scrollChain"===s||"scrollSavant"===s){const{uuid:e,category:a}=t.dataset,s=Number(t.dataset.level),n=t.value,i=await U(e,s,!0);i&&c.push(i),r[a]??=[],r[a].push({name:n,uuid:e})}else if("combatFlexibility"===s){const{category:e,uuid:a,level:s}=t.dataset,i=t.value,o="8"===s?0:1,l=D(e)[o];if(l){const e=h(n,l),t=await q(a,e);t&&c.push(t)}r[e]??=[],r[e].push({name:i,uuid:a})}else if("trainedLore"===s){const e=t.dataset.category,a=D(e)[0],s=t.value;if(a){const t=N(s,1);c.push(t),f.skills.push({uuid:a,selected:s,category:e})}r[e]=s}else if("tricksterAce"===s){const{category:e,uuid:a}=t.dataset,s=t.value,i=m("Trickster's Ace",{camel:"dromedary"}),o=await J(a,4,i);if(o){const e=G("Trickster's Ace",i,n.classDC?.slug||n.class?.slug);c.push(o),c.push(e)}r[e]={name:s,uuid:a}}else{const n=t.dataset.category,i=D(n)[0],o=l.find((e=>{return t=i,a(e)===t;var t}));if(!o)continue;const c=t.value,u=d(o);if("addedLanguage"===s)u.push({key:"ActiveEffectLike",mode:"add",path:"system.traits.languages.value",value:c,[e]:!0}),f.languages.push({uuid:i,selected:c,category:n});else if("trainedSkill"===s)u.push(H(c,1)),f.skills.push({uuid:i,selected:c,category:n});else if("addedResistance"===s)u.push(W(c,"half")),f.resistances.push({uuid:i,selected:c,category:n});else if("thaumaturgeTome"===s){const e=t.dataset.rank;u.push(H(c,e)),f.tome.push({uuid:i,selected:c,category:n,label:M[e]})}if("thaumaturgeTome"===s){const e=t.dataset.category;r[e]??=[],r[e].push(c)}else r[n]=c}}for(const[e,t]of p)u.push({_id:e,"system.rules":t});const b=(e,t)=>{if(!t.length)return;i&&(i+="<hr />");const a=z.has(e)?z(e):z("gained",{type:e});i+=`<p><strong>${a}</strong></p>`;for(const{uuid:e,selected:a,category:n,label:r}of t){if(r)i+=`<p><strong>${s=r,s?s[0].toUpperCase()+s.slice(1):""}:</strong>`;else{const t=n&&k(`label.${n}`)?v(`label.${n}`):void 0;i+=`<p>${I(e,t)}`}a&&(i+=` <span style="text-transform: capitalize;">${a}</span>`),i+="</p>"}var s};if(c.length){const e=await n.createEmbeddedDocuments("Item",c);for(const a of e){const s=a.uuid;if("feat"===a.type)f.feats.push({uuid:s});else if("consumable"===a.type)f.scrolls.push({uuid:s});else if("spellcastingEntry"===a.type){const s=a.slug,n=e.filter((e=>"spell"===e.type&&t(e,"parent")===s));for(const e of n)u.push({_id:e.id,"system.location.value":a.id}),f.spells.push({uuid:e.uuid})}const n=a.getFlag("pf2e","grantedBy.id");if(n){const e=`flags.pf2e.itemGrants.${m(a.name,{camel:"dromedary"})}`;u.push({_id:n,[e]:{id:a.id,onDelete:"detach"}})}}}var w,$;b("languages",f.languages),b("skills",f.skills),b("tome",f.tome),b("resistances",f.resistances),b("feats",f.feats),b("spells",f.spells),b("scrolls",f.scrolls),u.length&&await n.updateEmbeddedDocuments("Item",u),await(w=n,"saved",$=r,w.setFlag(e,"saved",$)),i=`${z("changes")}<hr>${i}`,ChatMessage.create({content:i,speaker:ChatMessage.getSpeaker({actor:n})})}function N(t,a){const s={type:"lore",img:"systems/pf2e/icons/default-icons/lore.svg",name:t,flags:{[e]:{temporary:!0}}};return setProperty(s,"system.proficient.value",a),s}async function q(t,a){const s=(await fromUuid(t))?.toObject();if(s)return setProperty(s,"flags.pf2e.grantedBy",{id:a.id,onDelete:"cascade"}),setProperty(s,`flags.${e}.temporary`,!0),s}function H(t,a){return{key:"ActiveEffectLike",mode:"upgrade",path:`system.skills.${t}.rank`,value:Number(a),[e]:!0}}function W(t,a){return"half"===a&&(a="max(1,floor(@actor.level/2))"),{key:"Resistance",type:t,value:a,[e]:!0}}async function J(t,a,s){const n=(await fromUuid(t))?.toObject();if(n)return setProperty(n,`flags.${e}.parent`,s),setProperty(n,"system.location.heightenedLevel",a),n}function G(t,a,s){const n={type:"spellcastingEntry",img:"systems/pf2e/icons/default-icons/spellcastingEntry.svg",name:t,flags:{[e]:{temporary:!0}}};return setProperty(n,"system",{slug:a,prepared:{value:"innate"},showSlotlessLevels:{value:!1},showUnpreparedSpells:{value:!1},proficiency:{value:1,slug:s}}),n}const Z=["common","draconic","dwarven","elven","gnomish","goblin","halfling","jotun","orcish","sylvan","undercommon","ysoki","abyssal","adlet","aklo","akitonian","alghollthu","amurrun","anadi","ancient-osiriani","anugobu","arcadian","aquan","arboreal","auran","boggard","calda","caligni","celestial","cyclops","daemonic","destrachan","drooni","dziriak","ekujae","erutaki","formian","garundi","girtablilu","gnoll","goloma","grippli","hallit","hwan","iblydan","ignan","ikeshti","immolis","infernal","iruxi","jistkan","jyoti","kaava","kashrishi","kibwani","kitsune","kelish","lirgeni","mahwek","minaten","minkaian","mwangi","mzunu","nagaji","necril","ocotan","okaiyan","osiriani","protean","rasu","ratajin","razatlani","requian","russian","senzar","shadowtongue","shobhad","shisk","shoanti","shoony","skald","sphinx","strix","taldane","tekritanin","tengu","terran","thassilonian","tien","utopian","vanara","varisian","varki","vishkanyan","vudrani","wyrwood","xanmba","androffan","azlanti","grioth","kovintal","migo","munavri","samsaran","sasquatch","shae","yithian","druidic"],V={acr:"acrobatics",arc:"arcana",ath:"athletics",cra:"crafting",dec:"deception",dip:"diplomacy",itm:"intimidation",med:"medicine",nat:"nature",occ:"occultism",prf:"performance",rel:"religion",soc:"society",ste:"stealth",sur:"survival",thi:"thievery"},Q=(Object.keys(V),Object.values(V)),K=["air","earth","fire","water"],X=["acid","electricity","sonic"],Y=new Proxy({addedLanguage:0,trainedSkill:1,addedResistance:2,trainedLore:3},{get:(e,t)=>t in e?e[t]:99});function ee(e){const s=e.level,n=t(e,"saved")??{},i=function(e){const t=e.itemTypes,s={},n=[...t.heritage,...t.feat,...t.equipment];for(const e of n){const t=a(e);if(!t||e.isOfType("equipment")&&!e.isInvested)continue;const n=x.get(t);if(!n)continue;const{category:i,index:r,type:o}=n;if(s[i]??={category:i,type:o,label:"",items:[]},s[i].items[r]=e,0===r){const t=`label.${i}`,a=k(t)?v(t):e.name;s[i].label=a}}return Object.values(s).filter((e=>e.items[0]))}(e),r=[];for(const t of i)if(j(t,"scrollChain")){const{type:e,category:a,label:i,items:o}=t,l=[],c=e=>{const{name:t="",uuid:s=""}=n[a]?.[e-1]??{};l.push({type:"drop",level:e,name:t,uuid:s,label:game.i18n.localize(`PF2E.SpellLevel${e}`)})};c(1),s>=8&&c(2),o[1]&&(c(3),s>=14&&c(4),s>=16&&c(5)),o[2]&&(c(6),s>=20&&c(7));const u={type:e,category:a,label:i,rows:l};r.push(u)}else if(j(t,"scrollSavant")){const{maxSlot:a,maxTradition:s}=ae(e,"arcane");if(a<4)continue;const{type:i,category:o,label:l}=t,c=[],u=(e,t)=>{const{name:a,uuid:s}=n[o]?.[e]??{name:"",uuid:""};return{type:"drop",level:t,name:a,uuid:s,label:game.i18n.localize(`PF2E.SpellLevel${t}`)}};s>=4&&a>=6&&c.push(u(3,a-5)),s>=3&&a>=5&&c.push(u(2,a-4)),c.push(u(1,a-3)),c.push(u(0,a-2));const p={type:i,category:o,label:l,rows:c};r.push(p)}else if(j(t,"trainedSkill")){const a=Q.filter((t=>e.skills[t].rank<1));if(!a.length)continue;const{type:s,category:i,label:o}=t,l={type:s,category:i,label:o,rows:[{type:"select",options:a,selected:n[i]??""}]};r.push(l)}else if(j(t,"thaumaturgeTome")){const{type:a,category:i,label:o,items:l}=t,c=[],u=e.skills,p=(e,t,a)=>{const s=n[i]?.[e]??"";c.push({type:"select",label:M[t],options:a,selected:s,rank:t})},d=(e,t="adept")=>{const a=l[e];return!!a&&"tome"===te(a,t)};if(d(4,"paragon")){const e=Q.filter((e=>u[e].rank<4));if(!e.length)continue;p(0,4,e),p(1,4,e)}else if(l[3]||d(2)||d(1)){const e=Q.filter((e=>u[e].rank<3));if(s>=9){if(!e.length)continue;p(0,3,e),p(1,3,e)}else{const t=Q.filter((e=>u[e].rank<2));if(!t.length)continue;p(0,2,t),e.length&&p(1,3,e)}}else if(s>=5){const e=Q.filter((e=>u[e].rank<2));if(!e.length)continue;p(0,2,e),p(1,2,e)}else if(s>=3){const e=Q.filter((e=>u[e].rank<1));if(!e.length)continue;p(0,1,e);const t=Q.filter((e=>u[e].rank<2));t.length&&p(1,2,t)}else{const e=Q.filter((e=>u[e].rank<1));if(!e.length)continue;p(0,1,e),p(1,1,e)}const f={type:a,category:i,label:o,rows:c};r.push(f)}else if(j(t,"trainedLore")){const{type:e,category:a,label:s}=t,i={type:e,category:a,label:s,rows:[{type:"input",selected:n[a]??"",placeholder:game.i18n.localize("PF2E.NewPlaceholders.Lore")}]};r.push(i)}else if(j(t,"addedLanguage")){const a=e.system.traits.languages.value,s=Z.filter((e=>!a.includes(e))).sort();if(!s.length)continue;const{type:i,category:o,label:l}=t,c={type:i,category:o,label:l,rows:[{type:"select",options:s,selected:n[o]??""}]};r.push(c)}else if(j(t,"addedResistance")){const{type:e,category:a,label:s}=t,i=n[a]??"",o={type:e,category:a,label:s,rows:[{type:"select",options:"elementalist"===a?K:X,selected:i}]};r.push(o)}else if(j(t,"combatFlexibility")){const{type:e,category:a,label:s,items:i}=t,o=n[a]??[],l=[{type:"drop",label:game.i18n.localize("PF2E.Level8"),name:o[0]?.name??"",uuid:o[0]?.uuid??"",level:8}];i[1]&&l.push({type:"drop",label:game.i18n.localize("PF2E.Level14"),name:o[1]?.name??"",uuid:o[1]?.uuid??"",level:14});const c={type:e,category:a,label:s,rows:l};r.push(c)}else if(j(t,"tricksterAce")){const{type:e,category:a,label:s}=t,{name:i="",uuid:o=""}=n[a]??{},l={type:e,category:a,label:s,rows:[{type:"drop",level:4,name:i,uuid:o}]};r.push(l)}const o=[],l=[];for(const e of r)e.rows.length>1?l.push(e):o.push(e);return o.sort(((e,t)=>Y[e.type]-Y[t.type])),l.sort(((e,t)=>e.rows.length-t.rows.length)),{rows:o,groups:l}}function te(e,t){return e._source.system.rules.find((e=>"ChoiceSet"===e.key&&e.rollOption===t))?.selection}function ae(e,t){let a=0,s=0;for(const n of e.spellcasting){if("pf2e-staves"in n.flags)continue;const e=n.system.slots;for(const t in e)e[t].max&&(a=Math.max(a,Number(t.slice(4))));n.tradition===t&&(s=Math.max(s,n.rank))}return{maxSlot:Math.clamped(a,1,10),maxTradition:s}}function se(e,t){const a=[];if(e<=t)for(let s=e;s<=t;s++)a.push(s);else for(let s=e;s>=t;s--)a.push(s);return a}const ne={scrollChain:{category:["spell"]},combatFlexibility:{feattype:["class"],traits:["fighter"]},scrollSavant:{category:["spell"],traditions:["arcane"]},tricksterAce:{category:["cantrip","spell"]}};function ie(e){e.preventDefault();const t=e.currentTarget.dataset,a=Number(t.level);switch(t.type){case"scrollChain":re({...ne.scrollChain,level:se(1,a)});break;case"combatFlexibility":!function({feattype:e=[],level:t={},traits:a=[]}={}){const s={feattype:e,skills:[],rarity:[],source:[],traits:a,level:t};game.pf2e.compendiumBrowser.openTab("feat",s)}({...ne.combatFlexibility,level:{min:1,max:a}});break;case"scrollSavant":re({...ne.scrollSavant,level:se(1,a)});break;case"tricksterAce":re({...ne.tricksterAce,level:se(1,a)})}}function re({category:e=[],level:t=[],traditions:a=[]}={}){const s={category:e,classes:[],level:t,rarity:[],school:[],source:[],traditions:a,traits:[]};game.pf2e.compendiumBrowser.openTab("spell",s)}const oe=w("interface.error.drop");function le(e){const t=e.system.time.value;return!(t.includes("hour")||t.includes("min")&&parseInt(t)>10)||(oe.warn("wrongSpellTime",{time:"10 min"}),!1)}function ce(e,t,{category:a=[],traditions:s=[]}={},n){if(!t.isOfType("spell"))return oe.warn("wrongType",{type:"spell"});if(t.isCantrip&&!a.includes("cantrip"))return oe.warn("cannotBe",{type:"spell",not:"cantrip"});if(t.isRitual&&!a.includes("ritual"))return oe.warn("cannotBe",{type:"spell",not:"ritual"});if(t.isFocusSpell&&!a.includes("focus"))return oe.warn("cannotBe",{type:"spell",not:"focus"});if(s.length){const e=t.system.traditions.value;for(const t of s)if(!e.includes(t))return oe.warn("wrongTrait",{type:"spell",trait:t,category:"tradition"})}if(t.level>Number(e.attr("data-level")))return oe.warn("wrongLevel",{type:"spell"});n&&!n(t)||ue(e,t)}function ue(e,t){e.val(t.name),e.attr("value",t.name),e.attr("data-uuid",t.uuid),e.nextAll('[data-action="clear"]').first().removeClass("disabled")}const pe=w("interface");class DailiesInterface extends Application{_actor;constructor(e,t){super(t),this._actor=e}static get defaultOptions(){return mergeObject(super.defaultOptions,{title:pe("title"),template:P("interface.hbs"),height:"auto",submitOnClose:!1,submitOnChange:!1,dragDrop:[{dropSelector:'[data-droppable="true"]'}]})}getData(e){return mergeObject(super.getData(e),{i18n:pe,...ee(this._actor)})}activateListeners(e){super.activateListeners(e),e.find("[data-action=search]").on("click",ie),e.find("[data-action=clear]").on("click",this.#e.bind(this)),e.find("[data-action=accept]").on("click",this.#t.bind(this)),e.find("[data-action=cancel]").on("click",this.#a.bind(this))}async _onDrop(e){!async function(e){let t=$(e.target);t.is("label")&&(t=t.next());const a=t.attr("data-type");if(a)try{const s=e.dataTransfer?.getData("text/plain"),n=()=>oe.warn("wrongDataType"),i=JSON.parse(s);if(!i||"Item"!==i.type||"string"!=typeof i.uuid)return n();const r=await fromUuid(i.uuid);if(!r)return n();switch(a){case"scrollChain":ce(t,r,ne.scrollChain);break;case"combatFlexibility":!function(e,t,{feattype:a=[],traits:s=[]}){if(!t.isOfType("feat")||t.isFeature)return oe.warn("wrongType",{type:"feat"});if(!a.includes(t.featType))return oe.warn("cannotBe",{type:"feat",not:t.featType});if(s.length){const e=t.system.traits.value;for(const t of s)if(!e.includes(t))return oe.warn("wrongTrait",{type:"feat",trait:t,category:"trait"})}if(t.level>Number(e.attr("data-level")))return oe.warn("wrongLevel",{type:"feat"});ue(e,t)}(t,r,ne.combatFlexibility);break;case"scrollSavant":ce(t,r,ne.scrollSavant);break;case"tricksterAce":ce(t,r,ne.tricksterAce,le)}}catch(e){}}(e)}#s(){this.element.addClass("disabled")}#n(){const e=[];return this.element.find("input").filter(((e,t)=>!t.value)).length&&e.push("error.empty"),e.forEach((e=>pe.warn(e))),!e.length}async#t(e){if(e.preventDefault(),this.#n()){this.#s();try{await B(this.element,this._actor)}catch(e){pe.error("error.unexpected"),console.error(e)}this.close()}}#e(e){e.preventDefault();const t=$(e.currentTarget),a=t.prevAll("input").first();a.val(""),a.attr("value",""),a.attr("data-uuid",""),t.addClass("disabled")}#a(e){e.preventDefault(),this.close()}}e||(e="pf2e-dailies"),Hooks.once("ready",(()=>{!function(){const e=game.pf2e.actions.restForTheNight;game.pf2e.actions.restForTheNight=async a=>{const s=await e(a);return s.length&&a.actors&&async function(e){const a=(e=Array.isArray(e)?e:[e]).filter((e=>e.isOfType("character")));for(const e of a){const a=[],s=[],n=e.itemTypes,i=e=>{const t=deepClone(e._source.system.rules);let s=!1;for(let e=t.length-1;e>=0;e--)"pf2e-dailies"in t[e]&&(t.splice(e,1),s=!0);s&&a.push({_id:e.id,"system.rules":t})};for(const e of n.feat)if(E(e)&&i(e),t(e,"temporary")){const t=e.getFlag("pf2e","grantedBy.id");if(t){const s=`flags.pf2e.itemGrants.-=${m(e.name,{camel:"dromedary"})}`;a.push({_id:t,[s]:!0})}s.push(e.id)}for(const e of n.lore)t(e,"temporary")&&s.push(e.id);for(const e of n.equipment)E(e)&&i(e);for(const e of n.heritage)E(e)&&i(e);for(const e of n.spellcastingEntry)t(e,"temporary")&&s.push(e.id);a.length&&e.updateEmbeddedDocuments("Item",a),s.length&&e.deleteEmbeddedDocuments("Item",s)}}(a.actors),s}}()})),Hooks.on("renderCharacterSheetPF2e",(function(e,t){const a=e.actor;if(!a.isOwner||!function(e){const t=e.itemTypes;return t.heritage.some((e=>s(e,A)))||t.feat.some((e=>s(e,T)))||t.equipment.some((e=>!(!1===e.isInvested)&&s(e,L)))}(a))return;const n=t.find("aside .sidebar .hitpoints .hp-small");n.append(`<a class="roll-icon dailies" title="${v("sheet.title")}"><i class="fas fa-mug-saucer"></i></a>`).find(".dailies").on("click",(()=>new DailiesInterface(a).render(!0,{id:`pf2e-dailies-interface-${a.id}`}))),n.find("[data-action=rest]").off("click").on("click",(e=>game.pf2e.actions.restForTheNight({event:e,actors:a})))}))})();
//# sourceMappingURL=main.js.map